<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Carrinho</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#FDFBF7] text-[#2D2926]">

<header class="text-center py-6">
  <h1 class="text-xl font-serif">Carrinho</h1>
</header>

<main class="max-w-md mx-auto px-6 space-y-6">

  <div id="cartItems" class="space-y-4"></div>

  <div class="border-t pt-4 space-y-3 text-sm">
    <div class="flex justify-between">
      <span>Subtotal</span>
      <span id="subtotal"></span>
    </div>

    <div id="pixRow" class="flex justify-between text-green-700 hidden">
      <span>Desconto PIX</span>
      <span id="pixDiscount"></span>
    </div>

    <div class="flex justify-between font-semibold text-base">
      <span>Total</span>
      <span id="total"></span>
    </div>
  </div>

  <div class="space-y-2">
    <button onclick="setPayment('pix')" id="pixBtn"
      class="w-full border py-3 text-xs uppercase">
      PIX
    </button>
    <button onclick="setPayment('card')" id="cardBtn"
      class="w-full border py-3 text-xs uppercase">
      Cartão
    </button>
  </div>

  <button onclick="goCheckout()"
    class="w-full bg-black text-white py-4 text-xs uppercase">
    Continuar
  </button>

</main>

<script>
const cart = JSON.parse(localStorage.getItem('luxury_cart')) || [];
const store = JSON.parse(localStorage.getItem('luxury_config')) || {};
let payment = 'pix';

const format = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

function render(){
  const wrap = document.getElementById('cartItems');
  wrap.innerHTML = '';

  let subtotal = 0;

  cart.forEach((p,i)=>{
    subtotal += p.price * p.qty;
    wrap.innerHTML += `
      <div class="flex justify-between items-center border p-3 text-xs">
        <div>
          <p class="uppercase">${p.name}</p>
          <p class="text-gray-400">${format(p.price)}</p>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="changeQty(${i},-1)">−</button>
          <span>${p.qty}</span>
          <button onclick="changeQty(${i},1)">+</button>
        </div>
      </div>
    `;
  });

  let discount = payment==='pix'
    ? subtotal * (store.pixDiscount || 0)
    : 0;

  document.getElementById('subtotal').innerText = format(subtotal);
  document.getElementById('total').innerText = format(subtotal - discount);

  document.getElementById('pixRow').classList.toggle('hidden', discount===0);
  document.getElementById('pixDiscount').innerText = `- ${format(discount)}`;
}

function changeQty(i,val){
  cart[i].qty += val;
  if(cart[i].qty<=0) cart.splice(i,1);
  localStorage.setItem('luxury_cart',JSON.stringify(cart));
  render();
}

function setPayment(p){
  payment = p;
  localStorage.setItem('luxury_payment',p);
  document.getElementById('pixBtn').classList.toggle('border-black',p==='pix');
  document.getElementById('cardBtn').classList.toggle('border-black',p==='card');
  render();
}

function goCheckout(){
  window.location.href='checkout.html';
}

setPayment('pix');
render();
</script>

</body>
</html>
