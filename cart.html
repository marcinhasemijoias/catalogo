<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Carrinho | Marcinha Semijoias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>body { font-family: 'Inter', sans-serif; background-color: #FDFBF7; }</style>
</head>
<body>
    <header class="py-10 text-center border-b bg-white">
        <a href="index.html" class="text-[10px] uppercase tracking-widest text-gray-400">← Continuar Comprando</a>
        <h1 class="font-serif text-2xl uppercase mt-2">Meu Carrinho</h1>
    </header>

    <main class="max-w-4xl mx-auto p-6 grid grid-cols-1 md:grid-cols-3 gap-8">
        <div id="cartList" class="md:col-span-2 space-y-4"></div>
        <div class="bg-white p-6 border h-fit sticky top-6">
            <h2 class="font-serif text-lg mb-4">Resumo</h2>
            <div class="space-y-2 border-b pb-4 mb-4 text-sm text-gray-500">
                <div class="flex justify-between"><span>Subtotal</span><span id="sub">R$ 0,00</span></div>
                <div class="flex justify-between text-green-600 font-bold"><span>Desconto PIX</span><span id="desc">- R$ 0,00</span></div>
            </div>
            <div class="mb-6 text-center">
                <p class="text-[10px] uppercase text-gray-400">Total no PIX</p>
                <p id="totalPIX" class="text-3xl font-serif text-[#A68966]">R$ 0,00</p>
                <p id="parc" class="text-[10px] text-gray-400 mt-1 uppercase"></p>
            </div>
            <input type="text" id="uName" placeholder="Seu Nome" class="w-full border-b py-2 mb-4 focus:outline-none">
            <button onclick="checkout()" class="w-full bg-black text-white py-4 text-[10px] uppercase tracking-widest">Finalizar WhatsApp</button>
        </div>
    </main>

    <script>
        const firebaseConfig = { /* mesmas chaves */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let settings = { phone: '5511999999999', pixDiscount: 5, installments: 3 };
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        db.ref('settings').on('value', s => { 
            if(s.val()) settings = s.val(); 
            render();
        });

        function render() {
            const list = document.getElementById("cartList");
            if(!cart.length) { list.innerHTML = "Vazio."; return; }
            
            list.innerHTML = cart.map((i, idx) => `
                <div class="flex gap-4 bg-white p-4 border items-center">
                    <img src="${i.image}" class="w-16 h-16 object-cover rounded">
                    <div class="flex-1">
                        <p class="text-[9px] font-mono text-gray-400">${i.sku}</p>
                        <p class="text-[11px] font-bold uppercase">${i.name}</p>
                        <p class="text-xs">R$ ${i.price.toFixed(2)}</p>
                    </div>
                    <button onclick="remove(${idx})" class="text-red-300 text-[9px] uppercase">Remover</button>
                </div>`).join('');

            const sub = cart.reduce((a,b) => a + b.price, 0);
            const savings = sub * (settings.pixDiscount/100);
            document.getElementById("sub").innerText = `R$ ${sub.toFixed(2)}`;
            document.getElementById("desc").innerText = `- R$ ${savings.toFixed(2)}`;
            document.getElementById("totalPIX").innerText = `R$ ${(sub - savings).toFixed(2)}`;
            document.getElementById("parc").innerText = `Ou R$ ${sub.toFixed(2)} em até ${settings.installments}x no cartão`;
        }

        function remove(idx) { cart.splice(idx, 1); localStorage.setItem("cart", JSON.stringify(cart)); render(); }

        function checkout() {
            const name = document.getElementById("uName").value;
            if(!name) return alert("Seu nome?");
            let msg = `*Pedido Marcinha Semijoias*\n*Cliente:* ${name}\n\n`;
            cart.forEach(i => msg += `• ${i.sku} - ${i.name} (R$ ${i.price.toFixed(2)})\n`);
            msg += `\n*Total PIX:* ${document.getElementById("totalPIX").innerText}`;
            window.location.href = `https://api.whatsapp.com/send?phone=${settings.phone}&text=${encodeURIComponent(msg)}`;
        }
    </script>
</body>
</html>
