<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Carrinho</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-neutral-50 p-4">

<h1 class="text-xl font-serif text-center mb-4">Carrinho</h1>

<div id="items" class="max-w-xl mx-auto space-y-3"></div>

<div class="max-w-xl mx-auto mt-6 border-t pt-4">
  <select id="payment" class="border p-2 w-full mb-2">
    <option value="PIX">PIX (com desconto)</option>
    <option value="CARD">Cartão</option>
  </select>

  <p class="text-lg">
    Total: R$ <span id="total">0</span>
  </p>

  <a href="checkout.html"
     class="block mt-4 bg-black text-white text-center py-3">
    Continuar
  </a>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
const pixDiscount = Number(localStorage.getItem("pixDiscount") || 0);
const items = document.getElementById("items");

function render() {
  let total = 0;
  items.innerHTML = "";

  cart.forEach((i, idx) => {
    total += i.price * i.qty;
    items.innerHTML += `
      <div class="border bg-white p-3 flex justify-between">
        <div>
          <p>${i.name}</p>
          <p class="text-sm">R$ ${i.price}</p>
        </div>
        <div>
          <button onclick="update(${idx},-1)">−</button>
          ${i.qty}
          <button onclick="update(${idx},1)">+</button>
        </div>
      </div>
    `;
  });

  const pay = payment.value;
  if (pay === "PIX") {
    total = total * (1 - pixDiscount / 100);
  }

  document.getElementById("total").innerText = total.toFixed(2);
  localStorage.setItem("payment", pay);
}

function update(i, v) {
  cart[i].qty += v;
  if (cart[i].qty <= 0) cart.splice(i, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  render();
}

payment.onchange = render;
render();
</script>

</body>
</html>
