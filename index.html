<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Marcinha Semijoias • Luxo Folheado</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root{
    --black:#0b0b0b;
    --gold:#d4af37;
    --soft:#f8f6f3;
    --gray:#b5b5b5;
}

body{
    font-family:'Montserrat',sans-serif;
    background:var(--soft);
    color:var(--black);
}

.serif{font-family:'Playfair Display',serif}

/* CARD */
.card-jewel{
    background:#fff;
    border-radius:22px;
    border:1px solid #eee;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    transition:.35s;
}
.card-jewel:hover{
    transform:translateY(-4px);
    box-shadow:0 18px 45px rgba(0,0,0,.08);
}

/* CARROSSEL */
.carousel-container{
    width:100%;
    aspect-ratio:1/1;
    display:flex;
    overflow-x:auto;
    scroll-snap-type:x mandatory;
    scrollbar-width:none;
}
.carousel-container::-webkit-scrollbar{display:none}
.carousel-item{
    min-width:100%;
    scroll-snap-align:start;
    padding:12px;
}
.carousel-item img{
    width:100%;
    height:100%;
    object-fit:contain;
    border-radius:18px;
    background:#fafafa;
}

/* BOTÃO */
.btn-buy{
    background:var(--black);
    color:#fff;
    width:100%;
    padding:15px;
    border-radius:14px;
    font-size:12px;
    font-weight:600;
    letter-spacing:.08em;
    text-transform:uppercase;
    transition:.3s;
}
.btn-buy:hover{
    background:var(--gold);
    color:#000;
}

/* BADGE */
.badge-promo{
    position:absolute;
    top:14px;
    left:14px;
    padding:6px 10px;
    font-size:9px;
    font-weight:700;
    letter-spacing:.1em;
    border-radius:20px;
    text-transform:uppercase;
    z-index:5;
}
</style>
</head>

<body>

<!-- HEADER -->
<header class="bg-white border-b border-[#eee] sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-6 text-center">
        <h1 class="serif text-4xl tracking-wide">
            MARCINHA <span class="text-[#d4af37]">SEMIJOIAS</span>
        </h1>

        <div class="flex justify-center gap-10 mt-5 text-[11px] font-semibold uppercase tracking-widest">
            <button onclick="carregarInicio()" class="hover:text-[#d4af37] transition">Coleções</button>
            <a href="carrinho.html" class="text-[#d4af37]">
                Carrinho (<span id="cart-total">R$ 0,00</span>)
            </a>
        </div>
    </div>
</header>

<!-- CONTEÚDO -->
<main class="max-w-7xl mx-auto px-6 py-10">
    <div id="grid-content" class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-10"></div>
</main>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
/* FIREBASE — MARCINHA SEMIJOIAS */
const firebaseConfig = {
  apiKey: "AIzaSyAQMdBkCMssdrtM4q3btyTrVyO940WkJK0",
  authDomain: "marcinha-semijoias-ee0c0.firebaseapp.com",
  databaseURL: "https://marcinha-semijoias-ee0c0-default-rtdb.firebaseio.com",
  projectId: "marcinha-semijoias-ee0c0",
  storageBucket: "marcinha-semijoias-ee0c0.firebasestorage.app",
  messagingSenderId: "846120624573",
  appId: "1:846120624573:web:7aa82e2a3df66c2e7d32d4"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let configLoja = {};

/* CONFIGURAÇÕES */
function carregarConfig(){
    db.ref('settings').on('value',snap=>{
        configLoja = snap.val() || {};
        carregarInicio();
    });
}

/* CATEGORIAS */
function carregarInicio(){
    db.ref('categories').once('value',snap=>{
        const grid=document.getElementById('grid-content');
        grid.innerHTML='';
        snap.forEach(s=>{
            const c=s.val();
            grid.innerHTML+=`
            <div class="card-jewel cursor-pointer" onclick="verProdutos('${s.key}','${c.name}')">
                <div class="carousel-item">
                    <img src="${c.image || 'https://via.placeholder.com/500'}">
                </div>
                <div class="p-6 text-center">
                    <h3 class="serif text-xl">${c.name}</h3>
                </div>
            </div>`;
        });
    });
}

/* PRODUTOS */
function verProdutos(catId,catName){
    db.ref('products').once('value',snap=>{
        const grid=document.getElementById('grid-content');
        grid.innerHTML='';
        const promoAtiva=configLoja.promocoes?.ativa||false;

        snap.forEach(s=>{
            const p=s.val();
            if(p.category===catId && !p.paused){
                const fotos=p.image.split(',').map(i=>i.trim());

                db.ref(`categories/${catId}`).once('value',catSnap=>{
                    const cat=catSnap.val()||{};
                    let desconto=promoAtiva?(p.promoPct||cat.promoPct||0):0;

                    const precoOriginal=p.price||0;
                    const precoFinal=precoOriginal*(1-desconto/100);
                    const parcelas=configLoja.empresa?.parcelas||1;
                    const descPix=configLoja.empresa?.descPix||0;
                    const precoPix=precoFinal*(1-descPix/100);

                    let imgs='';
                    fotos.forEach(f=>imgs+=`<div class="carousel-item"><img src="${f}"></div>`);

                    grid.innerHTML+=`
                    <div class="card-jewel relative p-4">
                        ${desconto>0?`<span class="badge-promo" style="background:${cat.promoColor||'#d4af37'};color:${cat.promoTextColor||'#000'}">${cat.promoTag||'OFERTA'}</span>`:''}

                        <div class="carousel-container">${imgs}</div>

                        <div class="mt-3 flex-1">
                            <h3 class="text-[11px] font-bold uppercase leading-tight h-8">${p.name}</h3>

                            <div class="mt-2">
                                ${desconto>0?`<span class="text-[10px] line-through text-gray-400 block">${precoOriginal.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</span>`:''}

                                <div class="text-xl font-black">
                                    ${precoFinal.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}
                                </div>

                                <div class="text-[10px] text-gray-500">
                                    ou ${parcelas}x de ${(precoFinal/parcelas).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}
                                </div>

                                <div class="text-[10px] font-semibold text-green-600 mt-1">
                                    ✨ ${precoPix.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})} no PIX
                                </div>
                            </div>
                        </div>

                        <button onclick='addCart(${JSON.stringify({...p,price:precoFinal,id:s.key})})' class="btn-buy mt-4">
                            Comprar
                        </button>
                    </div>`;
                });
            }
        });
    });
}

/* CARRINHO */
function addCart(p){
    let cart=JSON.parse(localStorage.getItem('marcinha_cart')||'[]');
    cart.push(p);
    localStorage.setItem('marcinha_cart',JSON.stringify(cart));
    atualizarTotalCarrinho();
    alert("Adicionado ao carrinho!");
}

function atualizarTotalCarrinho(){
    const cart=JSON.parse(localStorage.getItem('marcinha_cart')||'[]');
    const total=cart.reduce((a,i)=>a+parseFloat(i.price||0),0);
    document.getElementById('cart-total').innerText=
        total.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
}

window.onload=carregarConfig;
</script>

</body>
</html>
