<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cat√°logo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;600&display=swap');
    body { font-family: 'Inter', sans-serif; background:#FDFBF7; }
    .font-serif { font-family:'Playfair Display', serif; }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

function App(){

  const [products, setProducts] = useState([]);
  const [cart, setCart] = useState([]);
  const [view, setView] = useState('catalog');

  const [customer, setCustomer] = useState({ name:'', phone:'' });

  const [paymentMethod, setPaymentMethod] = useState('pix');
  const [installments, setInstallments] = useState(1);

  const [storeConfig, setStoreConfig] = useState({
    name: 'Abella Joias',
    pixDiscount: 0.1,
    cardInstallments: 6
  });

  const [lastOrder, setLastOrder] = useState(null);

  useEffect(()=>{
    setProducts(JSON.parse(localStorage.getItem('products')||'[]'));
    const cfg = JSON.parse(localStorage.getItem('storeConfig'));
    if(cfg) setStoreConfig(cfg);
  },[]);

  const format = v =>
    Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

  const subtotal = useMemo(
    ()=> cart.reduce((a,i)=>a+i.price*i.qty,0),
    [cart]
  );

  const pixTotal = subtotal * (1-storeConfig.pixDiscount);

  const addToCart = p =>{
    setCart(prev=>{
      const e = prev.find(i=>i.id===p.id);
      if(e) return prev.map(i=>i.id===p.id?{...i,qty:i.qty+1}:i);
      return [...prev,{...p,qty:1}];
    });
  };

  const removeItem = id =>
    setCart(cart.filter(i=>i.id!==id));

  const finalizeSale = ()=>{
    if(!customer.name || customer.phone.length<8){
      alert("Preencha nome e WhatsApp");
      return;
    }

    const order = {
      id: Math.floor(1000+Math.random()*9000),
      date: new Date().toLocaleString('pt-BR'),
      customer,
      items: cart,
      subtotal,
      total: paymentMethod==='pix'?pixTotal:subtotal,
      payment:
        paymentMethod==='pix'
        ? 'PIX'
        : `Cart√£o ${installments}x`
    };

    const orders = JSON.parse(localStorage.getItem('orders')||'[]');
    orders.push(order);
    localStorage.setItem('orders',JSON.stringify(orders));

    const updated = products.map(p=>{
      const i = cart.find(c=>c.id===p.id);
      return i?{...p,stock:p.stock-i.qty}:p;
    });
    localStorage.setItem('products',JSON.stringify(updated));
    setProducts(updated);

    setCart([]);
    setLastOrder(order);
    setView('confirmed');
  };

  return(
  <div className="min-h-screen pb-24">

    <header className="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
      <h1 className="font-serif tracking-widest">{storeConfig.name}</h1>
      <button onClick={()=>setView('cart')}>
        üõçÔ∏è {cart.length}
      </button>
    </header>

    <main className="max-w-5xl mx-auto p-4">

      {view==='catalog' && (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
          {products.map(p=>(
            <div key={p.id} className="space-y-3">
              <div className="aspect-[4/5] bg-gray-100">
                {p.image && (
                  <img src={p.image}
                    className="w-full h-full object-contain"
                  />
                )}
              </div>
              <h3 className="font-serif text-lg">{p.name}</h3>

              <p className="text-sm text-gray-500">
                {format(p.price)} <br/>
                <b className="text-[#A68966]">
                  {format(p.price*(1-storeConfig.pixDiscount))} no PIX
                </b><br/>
                ou {storeConfig.cardInstallments}x de {format(p.price/storeConfig.cardInstallments)}
              </p>

              <button
                onClick={()=>addToCart(p)}
                className="w-full bg-black text-white py-3 uppercase text-xs">
                Adicionar √† Sacola
              </button>
            </div>
          ))}
        </div>
      )}

      {view==='cart' && (
        <div className="space-y-6">

          <button onClick={()=>setView('catalog')} className="text-sm">
            ‚Üê Voltar
          </button>

          {cart.map(i=>(
            <div key={i.id} className="flex justify-between items-center border p-3">
              <div>
                <p className="font-bold">{i.name}</p>
                <p className="text-xs">{i.qty}x {format(i.price)}</p>
              </div>
              <button onClick={()=>removeItem(i.id)} className="text-red-500">
                Excluir
              </button>
            </div>
          ))}

          <div className="border p-4 space-y-4">
            <input placeholder="Seu nome"
              className="w-full border-b"
              value={customer.name}
              onChange={e=>setCustomer({...customer,name:e.target.value})}
            />
            <input placeholder="WhatsApp"
              className="w-full border-b"
              value={customer.phone}
              onChange={e=>setCustomer({...customer,phone:e.target.value})}
            />

            <div className="flex gap-2">
              <button
                onClick={()=>setPaymentMethod('pix')}
                className={`flex-1 py-2 border ${paymentMethod==='pix'?'bg-black text-white':''}`}>
                PIX
              </button>
              <button
                onClick={()=>setPaymentMethod('card')}
                className={`flex-1 py-2 border ${paymentMethod==='card'?'bg-black text-white':''}`}>
                Cart√£o
              </button>
            </div>

            {paymentMethod==='card' && (
              <select
                value={installments}
                onChange={e=>setInstallments(+e.target.value)}
                className="w-full border p-2">
                {Array.from({length:storeConfig.cardInstallments},(_,i)=>i+1)
                  .map(n=>(
                    <option key={n} value={n}>
                      {n}x de {format(subtotal/n)}
                    </option>
                ))}
              </select>
            )}

            <div className="text-right space-y-1">
              <p>Total: {format(subtotal)}</p>
              <p className="text-[#A68966]">
                PIX: {format(pixTotal)}
              </p>
            </div>
          </div>

          <button
            onClick={finalizeSale}
            className="w-full bg-[#A68966] text-white py-4 uppercase">
            Finalizar Pedido
          </button>

        </div>
      )}

      {view==='confirmed' && (
        <div className="text-center py-20 space-y-4">
          <h2 className="font-serif text-2xl">Pedido Confirmado</h2>
          <p>Aguarde nosso contato pelo WhatsApp.</p>
          <button onClick={()=>setView('catalog')}
            className="text-sm underline">
            Voltar √† loja
          </button>
        </div>
      )}

    </main>
  </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
