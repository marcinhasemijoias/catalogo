<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Joias - Coleção Exclusiva</title>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #FDFBF7; color: #2D2926; overflow-x: hidden; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .lux-border { border-color: #E5DACE; }
        .lux-gold { color: #A68966; }
        .cart-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); position: fixed; inset: 0; z-index: 50; }
        .payment-btn-active { border: 2px solid #A68966 !important; background: #FDFBF7; color: #A68966; font-weight: 800; }
        input:focus { border-bottom-color: #A68966 !important; outline: none; }
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #E5DACE; }
    </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const Icon = ({ name, size = 18, className = "" }) => {
    useEffect(() => { window.lucide && window.lucide.createIcons(); }, [name]);
    return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
};

function App() {
    const [products, setProducts] = useState([]);
    const [storeConfig, setStoreConfig] = useState({
        name: 'Royal Joias',
        whatsapp: '',
        pixDiscount: 10,
        maxInstallments: 12
    });

    const [cart, setCart] = useState([]);
    const [isCartOpen, setIsCartOpen] = useState(false);
    const [paymentMethod, setPaymentMethod] = useState('pix');
    const [selectedInstallment, setSelectedInstallment] = useState(1);
    const [customer, setCustomer] = useState({ name: '', phone: '' });
    const [orderStep, setOrderStep] = useState('cart');
    const [isSending, setIsSending] = useState(false);

    useEffect(() => {
        const savedProducts = localStorage.getItem('luxury_products');
        const savedConfig = localStorage.getItem('luxury_config');
        if (savedProducts) setProducts(JSON.parse(savedProducts));
        if (savedConfig) setStoreConfig(JSON.parse(savedConfig));
    }, []);

    const formatMoney = v => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    const totalBase = cart.reduce((acc, item) => acc + item.price * (item.quantity || 1), 0);
    const totalPix = totalBase * (1 - storeConfig.pixDiscount / 100);
    const valorFinal = paymentMethod === 'pix' ? totalPix : totalBase;

    const updateQuantity = (id, delta) => {
        setCart(cart.map(item => {
            if (item.id === id) {
                const newQty = Math.max(1, (item.quantity || 1) + delta);
                return { ...item, quantity: newQty };
            }
            return item;
        }));
    };

    const removeFromCart = (id) => {
        setCart(cart.filter(item => item.id !== id));
    };

    const addToCart = (product) => {
        const existing = cart.find(item => item.id === product.id);
        if (existing) {
            updateQuantity(product.id, 1);
        } else {
            setCart([...cart, { ...product, quantity: 1 }]);
        }
        setIsCartOpen(true);
        setOrderStep('cart');
    };

    const maskPhone = value => {
        let r = value.replace(/\D/g, "").substring(0, 11);
        if (r.length > 10) r = r.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
        else if (r.length > 5) r = r.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, "($1) $2-$3");
        else if (r.length > 2) r = r.replace(/^(\d{2})(\d{0,5})/, "($1) $2");
        else if (r.length > 0) r = r.replace(/^(\d*)/, "($1");
        return r;
    };

    const handleFinalizeWhatsApp = () => {
        if (isSending) return;
        const phoneStore = (storeConfig.whatsapp || '').replace(/\D/g, '');
        const phoneCustomer = customer.phone.replace(/\D/g, '');

        if (!customer.name || phoneCustomer.length < 10) {
            alert("Preencha seu nome e WhatsApp corretamente.");
            return;
        }
        if (!phoneStore) {
            alert("WhatsApp da loja não configurado no painel admin.");
            return;
        }

        setIsSending(true);
        const pedidoData = {
            id: `ORD-${Date.now()}`,
            date: new Date().toLocaleString('pt-BR'),
            customer: { name: customer.name, phone: '+55' + phoneCustomer },
            items: cart,
            paymentMethod: paymentMethod === 'pix' ? 'PIX' : `${selectedInstallment}x no Cartão`,
            total: valorFinal
        };

        const pedidosSalvos = JSON.parse(localStorage.getItem('luxury_orders') || '[]');
        localStorage.setItem('luxury_orders', JSON.stringify([pedidoData, ...pedidosSalvos]));

        const resumoItens = cart.map(i => `${i.quantity}x ${i.name}`).join(', ');
        const msg = `Olá! Gostaria de finalizar meu pedido na *${storeConfig.name}*:\n\n*Cliente:* ${customer.name}\n*Itens:* ${resumoItens}\n*Pagamento:* ${pedidoData.paymentMethod}\n*Total:* ${formatMoney(valorFinal)}\n\nAguardando confirmação!`;

        window.open(`https://wa.me/${phoneStore}?text=${encodeURIComponent(msg)}`, '_blank');

        setTimeout(() => {
            setOrderStep('success');
            setCart([]);
            setIsSending(false);
        }, 500);
    };

    return (
        <div className="min-h-screen">
            {/* HEADER */}
            <header className="bg-white border-b lux-border py-8 px-6 sticky top-0 z-40 flex justify-between items-center shadow-sm">
                <div className="w-10"></div>
                <h1 className="text-2xl font-serif tracking-[0.4em] uppercase">{storeConfig.name}</h1>
                <button onClick={() => { setIsCartOpen(true); setOrderStep('cart'); }} className="lux-gold p-2 relative">
                    <Icon name="shopping-bag" size={24} />
                    {cart.length > 0 && (
                        <span className="absolute -top-1 -right-1 bg-black text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">
                            {cart.reduce((a, b) => a + (b.quantity || 1), 0)}
                        </span>
                    )}
                </button>
            </header>

            {/* VITRINE */}
            <main className="max-w-5xl mx-auto px-6 py-16 grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-20">
                {products.length === 0 ? (
                    <div className="col-span-full text-center py-20 uppercase tracking-widest text-gray-400 text-xs">Coleção em atualização...</div>
                ) : products.map(product => (
                    <div key={product.id} className="flex flex-col text-center border-b lux-border pb-10 group">
                        <div className="overflow-hidden mb-6 border lux-border">
                            <img src={product.image} className="aspect-square w-full object-cover transition-transform duration-700 group-hover:scale-105" />
                        </div>
                        <h3 className="font-serif text-xl tracking-widest uppercase mb-2">{product.name}</h3>
                        <div className="mb-4">
                            <p className="text-xs text-gray-400 line-through">De {formatMoney(parseFloat(product.price))}</p>
                            <p className="lux-gold font-bold text-lg tracking-tighter">PIX: {formatMoney(product.price * (1 - storeConfig.pixDiscount/100))}</p>
                            <p className="text-[10px] text-gray-400 uppercase tracking-widest">Ou {storeConfig.maxInstallments}x de {formatMoney(product.price / storeConfig.maxInstallments)}</p>
                        </div>
                        <button onClick={() => addToCart(product)} className="bg-[#2D2926] text-white py-4 text-[10px] uppercase tracking-[0.3em] font-bold hover:bg-black transition-colors">Adicionar à Sacola</button>
                    </div>
                ))}
            </main>

            {/* SACOLA / CART */}
            {isCartOpen && (
                <div className="fixed inset-0 z-50">
                    <div className="cart-overlay" onClick={() => orderStep !== 'success' && setIsCartOpen(false)}></div>
                    <div className="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl flex flex-col z-[60] p-8">
                        
                        <div className="flex justify-between items-center mb-6 border-b lux-border pb-4">
                            <h2 className="font-serif text-2xl uppercase tracking-widest">
                                {orderStep === 'cart' ? 'Sacola' : orderStep === 'checkout' ? 'Checkout' : 'Sucesso'}
                            </h2>
                            {orderStep !== 'success' && <button onClick={() => setIsCartOpen(false)}><Icon name="x" size={24} /></button>}
                        </div>

                        {orderStep === 'cart' && (
                            <div className="flex flex-col h-full overflow-hidden">
                                <div className="flex-grow overflow-y-auto space-y-4 custom-scroll pr-2">
                                    {cart.length === 0 ? (
                                        <p className="text-center text-xs text-gray-400 uppercase mt-10">Sua sacola está vazia</p>
                                    ) : cart.map((item) => (
                                        <div key={item.id} className="flex gap-4 border-b lux-border pb-4 items-center">
                                            <img src={item.image} className="w-16 h-16 object-cover border" />
                                            <div className="flex-grow">
                                                <div className="text-[10px] font-bold uppercase mb-1">{item.name}</div>
                                                <div className="flex items-center gap-3">
                                                    <div className="flex items-center border lux-border rounded">
                                                        <button onClick={()=>updateQuantity(item.id, -1)} className="px-2 py-1 text-xs hover:bg-gray-50">-</button>
                                                        <span className="px-2 text-[10px] font-bold">{item.quantity || 1}</span>
                                                        <button onClick={()=>updateQuantity(item.id, 1)} className="px-2 py-1 text-xs hover:bg-gray-50">+</button>
                                                    </div>
                                                    <button onClick={()=>removeFromCart(item.id)} className="text-red-300 hover:text-red-500 transition-colors"><Icon name="trash-2" size={14}/></button>
                                                </div>
                                            </div>
                                            <div className="text-xs lux-gold font-bold">{formatMoney(parseFloat(item.price) * (item.quantity || 1))}</div>
                                        </div>
                                    ))}
                                </div>

                                {cart.length > 0 && (
                                    <div className="mt-4 pt-4 border-t-2 border-gray-100 space-y-4">
                                        <div className="space-y-2">
                                            <p className="text-[10px] uppercase text-gray-400 font-bold tracking-widest">Forma de Pagamento</p>
                                            <div className="grid grid-cols-2 gap-2">
                                                <button onClick={() => setPaymentMethod('pix')} className={`py-3 border text-[9px] font-bold uppercase tracking-widest transition-all ${paymentMethod === 'pix' ? 'payment-btn-active' : 'border-gray-100 text-gray-400'}`}>PIX (-{storeConfig.pixDiscount}%)</button>
                                                <button onClick={() => setPaymentMethod('card')} className={`py-3 border text-[9px] font-bold uppercase tracking-widest transition-all ${paymentMethod === 'card' ? 'payment-btn-active' : 'border-gray-100 text-gray-400'}`}>Cartão</button>
                                            </div>
                                            {paymentMethod === 'card' && (
                                                <select className="w-full border lux-border bg-transparent py-2 text-[10px] font-bold uppercase outline-none" value={selectedInstallment} onChange={e => setSelectedInstallment(e.target.value)}>
                                                    {[...Array(parseInt(storeConfig.maxInstallments))].map((_, i) => (
                                                        <option key={i+1} value={i+1}>{i+1}x de {formatMoney(totalBase / (i+1))} (Sem Juros)</option>
                                                    ))}
                                                </select>
                                            )}
                                        </div>
                                        <div className="space-y-1">
                                            <div className="flex justify-between text-[10px] text-gray-400 uppercase"><span>Subtotal</span><span>{formatMoney(totalBase)}</span></div>
                                            {paymentMethod === 'pix' && <div className="flex justify-between text-[10px] text-green-600 font-bold uppercase"><span>Desconto PIX</span><span>-{formatMoney(totalBase - totalPix)}</span></div>}
                                            <div className="flex justify-between font-serif text-xl uppercase pt-2"><span>Total</span><span className="lux-gold font-bold">{formatMoney(valorFinal)}</span></div>
                                        </div>
                                        <button onClick={() => setOrderStep('checkout')} className="w-full bg-[#2D2926] text-white py-5 text-[10px] font-bold uppercase tracking-[0.2em]">Avançar para Checkout</button>
                                    </div>
                                )}
                            </div>
                        )}

                        {orderStep === 'checkout' && (
                            <div className="flex flex-col h-full space-y-8">
                                <div className="space-y-6">
                                    <p className="text-[10px] uppercase text-gray-400 font-bold tracking-[0.1em]">Seus Dados para Envio</p>
                                    <div>
                                        <label className="text-[9px] uppercase text-gray-400 font-bold">Nome Completo</label>
                                        <input className="w-full border-b lux-border bg-transparent py-2 text-sm" placeholder="Seu nome" value={customer.name} onChange={e => setCustomer({...customer, name: e.target.value})} />
                                    </div>
                                    <div>
                                        <label className="text-[9px] uppercase text-gray-400 font-bold">WhatsApp</label>
                                        <input className="w-full border-b lux-border bg-transparent py-2 text-sm" placeholder="(00) 00000-0000" value={customer.phone} onChange={e => setCustomer({...customer, phone: maskPhone(e.target.value)})} />
                                    </div>
                                </div>
                                <div className="mt-auto border-t lux-border pt-6">
                                    <div className="bg-gray-50 p-4 rounded-lg mb-6">
                                        <p className="text-[9px] uppercase text-gray-400 mb-2">Total do Pedido</p>
                                        <p className="text-lg lux-gold font-black">{formatMoney(valorFinal)}</p>
                                    </div>
                                    <button onClick={handleFinalizeWhatsApp} disabled={isSending} className="w-full bg-[#2D2926] text-white py-6 text-[10px] font-bold uppercase tracking-[0.3em] shadow-xl hover:bg-black transition-colors disabled:opacity-50">
                                        {isSending ? 'Processando...' : 'Finalizar via WhatsApp'}
                                    </button>
                                    <button onClick={() => setOrderStep('cart')} className="w-full text-[9px] text-gray-400 uppercase font-bold mt-4 tracking-widest">Voltar</button>
                                </div>
                            </div>
                        )}

                        {orderStep === 'success' && (
                            <div className="flex flex-col items-center justify-center h-full text-center space-y-8">
                                <div className="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center text-green-600"><Icon name="check" size={40} /></div>
                                <h2 className="font-serif text-2xl uppercase tracking-widest">Pedido Enviado!</h2>
                                <p className="text-[11px] text-gray-400 uppercase tracking-widest leading-loose">Seu pedido foi registrado no sistema e a conversa iniciada.</p>
                                <button onClick={() => setIsCartOpen(false)} className="border border-black px-12 py-4 text-[10px] font-bold uppercase tracking-widest hover:bg-black hover:text-white transition-all">Voltar à Loja</button>
                            </div>
                        )}
                    </div>
                </div>
            )}
        </div>
    );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
