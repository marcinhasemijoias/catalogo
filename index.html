<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Catálogo | Marcinha Semijoias</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body{font-family:Arial;background:#f5f5f5;margin:0}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;padding:20px}
.card{background:#fff;padding:15px;border:1px solid #ddd}
button{background:#000;color:#fff;border:0;padding:8px;width:100%;cursor:pointer}
</style>
</head>
<body>

<h2 style="text-align:center;padding:20px">Catálogo Marcinha Semijoias</h2>
<div id="catalog" class="grid"></div>

<div style="position:fixed;bottom:0;left:0;right:0;background:#000;color:#fff;padding:10px">
<button onclick="checkout()">Finalizar no WhatsApp</button>
</div>

<script>
const firebaseConfig={
 apiKey:"SUA_API_KEY",
 authDomain:"SEU_AUTH",
 databaseURL:"SUA_DATABASE",
 projectId:"SEU_PROJECT",
 storageBucket:"SEU_BUCKET"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let cart=[];

function addToCart(p){
 if(p.stock<=0) return alert("Sem estoque");
 cart.push(p);
 alert("Adicionado ao carrinho");
}

function checkout(){
 if(!cart.length) return alert("Carrinho vazio");

 const name=prompt("Nome do cliente:");
 if(!name) return;

 db.ref('settings/pix').once('value', snap=>{
  const pix = snap.val() || 0;

  let txt="", total=0;
  cart.forEach(p=>{
   txt+=`${p.name} - R$ ${p.price}\n`;
   total+=Number(p.price);
  });

  const desconto = total*(pix/100);
  const totalPix = total-desconto;

  const order={
   customer:name,
   items:cart,
   total:totalPix.toFixed(2),
   payment:"PIX",
   date:new Date().toISOString()
  };

  db.ref('orders').push(order);

  cart.forEach(p=>{
   db.ref('products/'+p.id).update({stock:p.stock-1});
  });

  let msg=`*Pedido Marcinha Semijoias*\n\nCliente: ${name}\n\n${txt}\nTotal: R$ ${total}\nPIX (${pix}% OFF): R$ ${totalPix.toFixed(2)}`;

  window.open(`https://wa.me/55SEUNUMERO?text=${encodeURIComponent(msg)}`);
  cart=[];
 });
}

db.ref('products').on('value', snap=>{
 const c=document.getElementById('catalog');
 c.innerHTML='';
 snap.forEach(s=>{
  const p=s.val(); p.id=s.key;
  c.innerHTML+=`
  <div class="card">
   <img src="${p.image}" style="width:100%;height:200px;object-fit:cover">
   <h4>${p.name}</h4>
   <p>R$ ${p.price}</p>
   <small>Estoque: ${p.stock}</small>
   <button onclick='addToCart(${JSON.stringify(p)})'>Adicionar</button>
  </div>`;
 });
});
</script>
</body>
</html>
