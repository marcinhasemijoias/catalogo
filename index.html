<script>
const store = JSON.parse(localStorage.getItem('luxury_config')) || {};
const products = JSON.parse(localStorage.getItem('luxury_products')) || [];
let cart = JSON.parse(localStorage.getItem('luxury_cart')) || [];

const format = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

document.getElementById('storeName').innerText = store.name || 'CatÃ¡logo';

function updateCartCount(){
  document.getElementById('cartCount').innerText =
    cart.reduce((s,p)=>s+p.qty,0);
}

function addToCart(id){
  const p = products.find(p=>p.id===id);
  const item = cart.find(i=>i.id===id);
  if(item){ item.qty++; }
  else{ cart.push({...p, qty:1}); }

  localStorage.setItem('luxury_cart', JSON.stringify(cart));
  updateCartCount();
}

const grid = document.getElementById('productGrid');

products.forEach(p=>{
  const pix = p.price - (p.price * (store.pixDiscount || 0) / 100);
  const parcela = p.price / (store.maxInstallments || 1);

  grid.innerHTML += `
    <div class="bg-white border p-6 text-center space-y-4">
      <img src="${p.image}" class="h-48 mx-auto object-contain">
      <p class="uppercase text-sm">${p.name}</p>
      <p class="line-through text-gray-400">${format(p.price)}</p>
      <p class="text-green-700 font-semibold">PIX ${format(pix)}</p>
      <p class="text-xs text-gray-500">
        ${store.maxInstallments}x de ${format(parcela)}
      </p>
      <button onclick="addToCart(${p.id})"
        class="w-full bg-black text-white py-3 text-xs uppercase">
        Adicionar ao carrinho
      </button>
    </div>
  `;
});

updateCartCount();
</script>
