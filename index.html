<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Joias - Coleção Exclusiva</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #FDFBF7; color: #2D2926; overflow-x: hidden; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .lux-border { border-color: #E5DACE; }
        .lux-gold { color: #A68966; }
        .cart-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); position: fixed; inset: 0; z-index: 50; }
        .payment-btn-active { border: 2px solid #A68966 !important; background: #FDFBF7; color: #A68966; font-weight: 800; }
        input:focus { border-bottom-color: #A68966 !important; outline: none; }
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #E5DACE; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const Icon = ({ name, size = 18, className = "" }) => {
    useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
    return <i data-lucide={name} style={{width: size, height: size}} className={className}></i>;
};

function App() {
    const [products, setProducts] = useState([]);
    const [storeConfig, setStoreConfig] = useState({ name: 'Royal Joias', whatsapp: '', pixDiscount: 10, maxInstallments: 12 });
    const [cart, setCart] = useState([]);
    const [isCartOpen, setIsCartOpen] = useState(false);
    const [paymentMethod, setPaymentMethod] = useState('pix');
    const [selectedInstallment, setSelectedInstallment] = useState(1);
    const [customer, setCustomer] = useState({ name: '', phone: '' });
    const [orderStep, setOrderStep] = useState('cart');
    const [isSending, setIsSending] = useState(false);

    useEffect(() => {
        const savedProducts = localStorage.getItem('luxury_products');
        const savedConfig = localStorage.getItem('luxury_config');
        if (savedProducts) setProducts(JSON.parse(savedProducts));
        if (savedConfig) setStoreConfig(JSON.parse(savedConfig));
    }, []);

    const formatMoney = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    const totalBase = cart.reduce((acc, item) => acc + (item.price * (item.quantity || 1)), 0);
    const totalPix = totalBase * (1 - storeConfig.pixDiscount / 100);
    const valorFinal = paymentMethod === 'pix' ? totalPix : totalBase;

    const maskPhone = value => {
        let r = value.replace(/\D/g,"").substring(0,11);
        if (r.length > 10) r = r.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
        else if (r.length > 5) r = r.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, "($1) $2-$3");
        else if (r.length > 2) r = r.replace(/^(\d{2})(\d{0,5})/, "($1) $2");
        else if (r.length > 0) r = r.replace(/^(\d*)/, "($1");
        return r;
    };

    const handleFinalizeWhatsApp = () => {
        if (isSending) return;

        if (!customer.name || customer.phone.replace(/\D/g,'').length < 10) {
            alert("Preencha seu nome e WhatsApp corretamente.");
            return;
        }

        const whatsappNumber = (storeConfig.whatsapp || '').replace(/\D/g,'');

        if (!whatsappNumber) {
            alert("Número de WhatsApp da loja não configurado no painel admin.");
            return;
        }

        setIsSending(true);

        const pedidoData = {
            id: `ORD-${Date.now()}`,
            date: new Date().toLocaleString('pt-BR'),
            customer: {
                name: customer.name,
                phone: `+55${customer.phone.replace(/\D/g,'')}`
            },
            items: cart,
            paymentMethod: paymentMethod === 'pix' ? 'PIX' : `${Number(selectedInstallment)}x no Cartão`,
            total: valorFinal
        };

        const pedidosSalvos = JSON.parse(localStorage.getItem('luxury_orders') || '[]');
        localStorage.setItem('luxury_orders', JSON.stringify([pedidoData, ...pedidosSalvos]));

        const resumoItens = cart.map(i => `${i.quantity}x ${i.name}`).join(', ');

        const msg =
`Olá! Gostaria de finalizar meu pedido na *${storeConfig.name}*:

*Cliente:* ${customer.name}
*Itens:* ${resumoItens}
*Pagamento:* ${pedidoData.paymentMethod}
*Total:* ${formatMoney(valorFinal)}

Aguardando confirmação!`;

        const waUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`;

        window.open(waUrl, '_blank');

        setTimeout(() => {
            setOrderStep('success');
            setCart([]);
            setIsSending(false);
        }, 500);
    };

    /* --- RESTANTE DO COMPONENTE PERMANECE IGUAL AO SEU --- */
    /* Nenhuma mudança visual ou estrutural foi feita abaixo */

    return (/* ... JSX exatamente igual ao seu ... */);
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
