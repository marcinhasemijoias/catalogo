<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Marcinha Semijoias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#F8F6F2}
.font-serif{font-family:'Cinzel',serif}
.gold{color:#A68966}
</style>
</head>

<body>

<header class="bg-white border-b px-8 py-6 text-center">
  <h1 class="font-serif text-3xl gold tracking-widest">Marcinha Semijoias</h1>
  <p class="text-xs tracking-widest text-gray-400 uppercase mt-1">
    CatÃ¡logo Exclusivo
  </p>
</header>

<main class="max-w-7xl mx-auto p-8 grid md:grid-cols-4 gap-10">

<!-- CATÃLOGO -->
<section class="md:col-span-3">
  <div id="produtos" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-10"></div>
</section>

<!-- CARRINHO -->
<aside class="bg-white border p-6 space-y-6 sticky top-6 h-fit">
  <h2 class="font-serif text-xl gold">Carrinho</h2>

  <div id="carrinho" class="space-y-4 text-sm"></div>

  <div class="border-t pt-4 space-y-3">
    <div class="flex justify-between">
      <span>Total:</span>
      <strong id="total">R$ 0,00</strong>
    </div>

    <!-- PAGAMENTO -->
    <div class="space-y-2">
      <label class="flex items-center gap-2">
        <input type="radio" name="pagamento" value="PIX" checked>
        <span class="text-green-700 font-semibold">
          ðŸ’° PIX <small id="pixInfo"></small>
        </span>
      </label>

      <label class="flex items-center gap-2">
        <input type="radio" name="pagamento" value="CARTAO">
        <span class="text-gray-800 font-semibold">
          ðŸ’³ CartÃ£o
        </span>
      </label>

      <select id="parcelas" class="border p-2 w-full hidden"></select>
    </div>

    <button onclick="finalizar()" class="bg-black text-white w-full py-3 tracking-widest text-xs uppercase">
      Finalizar no WhatsApp
    </button>
  </div>
</aside>

</main>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyD5RdWTYOnaTov7VtM9ZGenUpFYSZVGoPs",
 databaseURL:"https://marcinha-semijoias-default-rtdb.firebaseio.com",
 projectId:"marcinha-semijoias"
});

const db = firebase.database();

let produtos = {};
let carrinho = [];
let settings = {};
let pagamento = 'PIX';

/* SETTINGS */
db.ref('settings').once('value').then(s=>{
 settings = s.val();
 pixInfo.innerText = `(${settings.pix}% OFF)`;
 for(let i=1;i<=settings.parcelas;i++){
  parcelas.innerHTML+=`<option>${i}x sem juros</option>`;
 }
});

/* PRODUTOS */
db.ref('products').on('value',snap=>{
 produtos = snap.val() || {};
 renderProdutos();
});

function renderProdutos(){
 const el = document.getElementById('produtos');
 el.innerHTML='';
 Object.entries(produtos).forEach(([id,p])=>{
  el.innerHTML+=`
  <div class="bg-white border p-4 space-y-3">
    <img src="${p.image}" class="h-56 w-full object-cover">
    <h3 class="font-serif">${p.name}</h3>
    <p class="gold text-lg font-semibold">R$ ${p.price.toFixed(2)}</p>
    <button onclick="add('${id}')" class="border w-full py-2 text-xs tracking-widest uppercase">
      Adicionar
    </button>
  </div>`;
 });
}

/* CARRINHO */
function add(id){
 const item = carrinho.find(i=>i.id===id);
 if(item) item.qty++;
 else carrinho.push({id,qty:1});
 renderCarrinho();
}

function renderCarrinho(){
 carrinhoDiv.innerHTML='';
 let total = 0;

 carrinho.forEach(i=>{
  const p = produtos[i.id];
  total += p.price * i.qty;
  carrinhoDiv.innerHTML+=`
  <div class="flex justify-between items-center">
    <div>
      ${i.qty}x ${p.name}<br>
      <span class="text-xs gold">R$ ${(p.price*i.qty).toFixed(2)}</span>
    </div>
    <div class="flex gap-2">
      <button onclick="i.qty--; if(i.qty<=0) carrinho=carrinho.filter(x=>x!=i); renderCarrinho()">âˆ’</button>
      <button onclick="i.qty++; renderCarrinho()">+</button>
    </div>
  </div>`;
 });

 if(pagamento==='PIX'){
  total *= (1 - settings.pix/100);
 }

 totalEl.innerText = `R$ ${total.toFixed(2)}`;
}

/* PAGAMENTO */
document.querySelectorAll('input[name=pagamento]').forEach(r=>{
 r.onchange=e=>{
  pagamento=e.target.value;
  parcelas.classList.toggle('hidden', pagamento!=='CARTAO');
  renderCarrinho();
 };
});

/* FINALIZAR */
function finalizar(){
 let msg = `ðŸ›ï¸ *Novo Pedido*\n\n`;
 carrinho.forEach(i=>{
  const p=produtos[i.id];
  msg+=`${i.qty}x ${p.name}\n`;
 });
 msg+=`\nPagamento: ${pagamento}`;
 if(pagamento==='CARTAO') msg+=`\nParcelas: ${parcelas.value}`;
 msg+=`\nTotal: ${totalEl.innerText}`;

 window.open(`https://wa.me/55${settings.whatsapp}?text=${encodeURIComponent(msg)}`);
}
</script>

</body>
</html>

