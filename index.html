<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Royal Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script src="https://unpkg.com/lucide@latest"></script>

</head>

<body>
<div id="root"></div>

<script type="text/babel">

const {
 ShoppingCart, Trash2, ChevronLeft,
 CreditCard, QrCode, CheckCircle2,
 MessageCircle, Download, Star
} = lucide;

const { useState, useEffect, useMemo } = React;

function App() {

const [view, setView] = useState('catalog');
const [products, setProducts] = useState([]);
const [cart, setCart] = useState([]);
const [customerData, setCustomerData] = useState({ name:'', phone:'' });
const [paymentMethod, setPaymentMethod] = useState('pix');
const [installments, setInstallments] = useState(1);
const [orders, setOrders] = useState([]);
const [activeOrder, setActiveOrder] = useState(null);

const [storeConfig, setStoreConfig] = useState({
 name:'Royal Joias',
 whatsapp:'5511999999999',
 pixDiscount:0.1,
 maxInstallments:12
});

useEffect(()=>{
 const p = localStorage.getItem('luxury_products');
 const c = localStorage.getItem('luxury_config');
 const o = localStorage.getItem('luxury_orders');

 if(p) setProducts(JSON.parse(p));
 if(c) setStoreConfig(JSON.parse(c));
 if(o) setOrders(JSON.parse(o));

 const script=document.createElement('script');
 script.src='https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
 document.body.appendChild(script);
},[]);

const subtotal = useMemo(()=>cart.reduce((a,i)=>a+i.price*i.quantity,0),[cart]);
const discount = paymentMethod==='pix'?subtotal*storeConfig.pixDiscount:0;
const total = subtotal-discount;

const format = v=>v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

function finalizePurchase(){
 if(!customerData.name) return alert('Informe o nome');
 const order={
  id:Date.now(),
  date:new Date().toLocaleString('pt-BR'),
  customer:customerData,
  items:cart,
  paymentMethod,
  installments:paymentMethod==='card'?installments:1,
  subtotal,discount,total
 };
 const newOrders=[order,...orders];
 localStorage.setItem('luxury_orders',JSON.stringify(newOrders));
 setOrders(newOrders);
 setActiveOrder(order);
 setView('success');
}

function sendWhats(order){
 const msg=`PEDIDO CONFIRMADO - ${storeConfig.name}
Cliente: ${order.customer.name}
Total: ${format(order.total)}`;
 window.open(`https://wa.me/${storeConfig.whatsapp}?text=${encodeURIComponent(msg)}`);
}

return (
<div className="min-h-screen bg-[#FDFBF7] font-serif text-[#2D2926]">

<header className="sticky top-0 z-50 bg-white border-b border-[#E5DACE] px-6 py-4 flex justify-between items-center shadow-sm">
<button onClick={()=>location.href='admin.html'} className="text-[#A68966] p-2">⚙️</button>
<h1 className="text-lg tracking-[0.4em] uppercase">{storeConfig.name}</h1>
<button onClick={()=>setView('cart')} className="relative p-2">
<ShoppingCart size={20}/>
{cart.length>0 && <span className="absolute top-0 right-0 bg-[#A68966] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center">{cart.length}</span>}
</button>
</header>

<main className="max-w-2xl mx-auto p-6 pb-32">

{view==='catalog' && (
<div className="grid grid-cols-1 md:grid-cols-2 gap-10">
{products.map(p=>(
<div key={p.id} onClick={()=>{setCart([{...p,quantity:1}]);setView('cart')}} className="text-center cursor-pointer">
<div className="h-64 bg-[#F5F2EE] flex items-center justify-center mb-4">
<Star size={40} strokeWidth={0.5} className="text-[#A68966]"/>
</div>
<h3 className="text-xs uppercase tracking-widest font-bold">{p.name}</h3>
<p className="text-sm mt-1 font-sans text-gray-500">{format(p.price)}</p>
</div>
))}
</div>
)}

{view==='cart' && (
<div className="max-w-md mx-auto font-sans space-y-4">
<input placeholder="Nome" className="w-full border-b py-2" value={customerData.name} onChange={e=>setCustomerData({...customerData,name:e.target.value})}/>
<input placeholder="WhatsApp" className="w-full border-b py-2" value={customerData.phone} onChange={e=>setCustomerData({...customerData,phone:e.target.value})}/>

<div className="grid grid-cols-2 gap-2">
<button onClick={()=>setPaymentMethod('pix')} className={`p-4 border ${paymentMethod==='pix'?'border-[#A68966]':''}`}><QrCode/>PIX</button>
<button onClick={()=>setPaymentMethod('card')} className={`p-4 border ${paymentMethod==='card'?'border-[#A68966]':''}`}><CreditCard/>Cartão</button>
</div>

{paymentMethod==='card' &&
<select className="w-full border p-3" value={installments} onChange={e=>setInstallments(+e.target.value)}>
{[...Array(storeConfig.maxInstallments)].map((_,i)=>(
<option key={i}>{i+1}x de {format(total/(i+1))}</option>
))}
</select>}

<button onClick={finalizePurchase} className="w-full bg-[#2D2926] text-white py-4 uppercase tracking-widest">
Finalizar
</button>
</div>
)}

{view==='success' && activeOrder && (
<div className="text-center space-y-6">
<CheckCircle2 size={64} className="mx-auto text-[#A68966]"/>
<button onClick={()=>sendWhats(activeOrder)} className="bg-[#25D366] text-white py-4 w-full flex justify-center gap-2"><MessageCircle/> WhatsApp</button>
<button onClick={()=>setView('catalog')} className="text-xs uppercase">Voltar</button>
</div>
)}

</main>

<footer className="fixed bottom-0 w-full bg-white/90 border-t py-4 text-center">
<p className="text-[9px] tracking-[0.6em] uppercase text-[#A68966] font-bold">Royal Joias</p>
</footer>

</div>
);
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>

