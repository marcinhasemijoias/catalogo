<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Catálogo | Abella Joias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body class="bg-[#FAF9F7] text-[#2D2926]">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

/* CONFIGURAÇÕES */
const storeConfig = {
  company: "Abella Joias",
  whatsapp: "5599999999999",
  pixDiscount: 0.1,
  cardInstallments: 6
};

function formatCurrency(v) {
  return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

function App() {
  const [products, setProducts] = useState([]);
  const [cart, setCart] = useState([]);
  const [view, setView] = useState("catalog");

  const [payment, setPayment] = useState("pix");
  const [installments, setInstallments] = useState(1);

  const [customer, setCustomer] = useState({
    name: "",
    ddi: "+55",
    phone: ""
  });

  useEffect(() => {
    setProducts(JSON.parse(localStorage.getItem("products") || "[]"));
  }, []);

  function addToCart(p) {
    setCart(prev => {
      const found = prev.find(i => i.id === p.id);
      if (found) {
        return prev.map(i =>
          i.id === p.id ? { ...i, qty: i.qty + 1 } : i
        );
      }
      return [...prev, { ...p, qty: 1 }];
    });
  }

  function removeItem(id) {
    setCart(prev => prev.filter(i => i.id !== id));
  }

  function total() {
    return cart.reduce((s, i) => s + i.price * i.qty, 0);
  }

  function finalizeSale() {
    if (!customer.name || !customer.phone) {
      alert("Informe nome e telefone para finalizar.");
      return;
    }

    const order = {
      id: Date.now(),
      date: new Date().toLocaleString(),
      customer,
      items: cart,
      payment,
      installments,
      total: total()
    };

    const orders = JSON.parse(localStorage.getItem("orders") || "[]");
    orders.push(order);
    localStorage.setItem("orders", JSON.stringify(orders));

    alert("Pedido confirmado! Aguarde o contato da empresa.");

    setCart([]);
    setCustomer({ name: "", ddi: "+55", phone: "" });
    setView("catalog");
  }

  return (
    <div className="max-w-6xl mx-auto p-6">

      {/* HEADER */}
      <header className="flex justify-between items-center mb-10">
        <h1 className="font-serif text-3xl">{storeConfig.company}</h1>

        <button
          onClick={() => setView("cart")}
          className="relative text-[#A68966] hover:opacity-70 transition"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"
            fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
            <circle cx="8" cy="21" r="1"/>
            <circle cx="19" cy="21" r="1"/>
            <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
          </svg>
          {cart.length > 0 && (
            <span className="absolute -top-2 -right-2 bg-black text-white text-xs rounded-full px-1">
              {cart.length}
            </span>
          )}
        </button>
      </header>

      {/* CATÁLOGO */}
      {view === "catalog" && (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
          {products.map(p => (
            <div key={p.id}>
              <div className="aspect-[4/5] bg-[#F5F2EE] mb-4 flex items-center justify-center">
                {p.image && <img src={p.image} className="object-contain h-full" />}
              </div>

              <div className="font-serif border-b pb-3 mb-3">
                <h3 className="text-xl">{p.name}</h3>
                <p className="text-xs text-[#A68966] uppercase">
                  {formatCurrency(p.price * (1 - storeConfig.pixDiscount))} no PIX
                </p>
                <p className="text-xs text-gray-400">
                  ou {storeConfig.cardInstallments}x de {formatCurrency(p.price / storeConfig.cardInstallments)}
                </p>
              </div>

              <button
                onClick={() => addToCart(p)}
                className="w-full bg-[#2D2926] text-white py-4 text-xs uppercase tracking-widest"
              >
                Adicionar à Sacola
              </button>
            </div>
          ))}
        </div>
      )}

      {/* CARRINHO */}
      {view === "cart" && (
        <div className="max-w-3xl mx-auto space-y-10">

          {/* ITENS */}
          <div className="space-y-4">
            {cart.map(i => (
              <div key={i.id} className="flex gap-4 items-center bg-white p-4 shadow-sm">
                <div className="w-16 h-20 bg-gray-100 flex items-center justify-center">
                  {i.image && <img src={i.image} className="object-contain h-full" />}
                </div>

                <div className="flex-1">
                  <p className="font-serif">{i.name}</p>
                  <p className="text-xs text-gray-500">{i.qty}x {formatCurrency(i.price)}</p>
                </div>

                <button
                  onClick={() => removeItem(i.id)}
                  className="text-red-400 text-xs"
                >
                  Excluir
                </button>
              </div>
            ))}
          </div>

          {/* DADOS DO CLIENTE */}
          <div className="bg-white p-6 shadow-sm space-y-4">
            <h2 className="font-serif text-xl border-b pb-2">Seus dados</h2>

            <input
              type="text"
              placeholder="Nome completo"
              value={customer.name}
              onChange={e => setCustomer({ ...customer, name: e.target.value })}
              className="w-full border p-3"
            />

            <div className="flex gap-2">
              <input
                type="text"
                value={customer.ddi}
                onChange={e => setCustomer({ ...customer, ddi: e.target.value })}
                className="w-20 border p-3"
              />
              <input
                type="tel"
                placeholder="WhatsApp"
                value={customer.phone}
                onChange={e => setCustomer({ ...customer, phone: e.target.value })}
                className="flex-1 border p-3"
              />
            </div>
          </div>

          {/* PAGAMENTO */}
          <div className="bg-white p-6 shadow-sm space-y-4">
            <h2 className="font-serif text-xl border-b pb-2">Pagamento</h2>

            <button
              onClick={() => setPayment("pix")}
              className={`w-full py-3 border ${payment==="pix" ? "bg-black text-white" : ""}`}
            >
              PIX ({formatCurrency(total() * (1 - storeConfig.pixDiscount))})
            </button>

            <button
              onClick={() => setPayment("card")}
              className={`w-full py-3 border ${payment==="card" ? "bg-black text-white" : ""}`}
            >
              Cartão
            </button>

            {payment === "card" && (
              <select
                value={installments}
                onChange={e => setInstallments(+e.target.value)}
                className="w-full border p-3"
              >
                {[...Array(storeConfig.cardInstallments)].map((_, i) => (
                  <option key={i} value={i+1}>
                    {i+1}x de {formatCurrency(total() / (i+1))}
                  </option>
                ))}
              </select>
            )}

            <button
              onClick={finalizeSale}
              className="w-full bg-[#2D2926] text-white py-4 uppercase tracking-widest"
            >
              Finalizar Pedido
            </button>
          </div>

        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
