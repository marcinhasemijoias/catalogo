<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Royal Joias - Coleção Exclusiva</title>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Fonts -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap');
    body { font-family: 'Inter', sans-serif; background:#FDFBF7; color:#2D2926; }
    .font-serif { font-family:'Playfair Display', serif; }
    .lux-border { border-color:#E5DACE; }
    .lux-gold { color:#A68966; }
    .cart-overlay { background:rgba(0,0,0,.5); backdrop-filter:blur(8px); position:fixed; inset:0; z-index:50; }
    .payment-btn-active { border:2px solid #A68966!important; color:#A68966; font-weight:800; }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const Icon = ({ name, size=18 }) => {
  useEffect(() => { window.lucide && window.lucide.createIcons(); }, [name]);
  return <i data-lucide={name} style={{width:size,height:size}}></i>;
};

function App(){

  const [products, setProducts] = useState([]);
  const [cart, setCart] = useState([]);
  const [isCartOpen, setIsCartOpen] = useState(false);
  const [paymentMethod, setPaymentMethod] = useState('pix');
  const [installment, setInstallment] = useState(1);
  const [step, setStep] = useState('cart');
  const [sending, setSending] = useState(false);

  const [customer, setCustomer] = useState({
    name:'',
    phone:'',
    notes:''
  });

  const storeConfig = {
    name: 'Royal Joias',
    whatsapp: '5599999999999',
    pixDiscount: 5,
    maxInstallments: 12
  };

  useEffect(() => {
    const p = JSON.parse(localStorage.getItem('luxury_products') || '[]');
    const c = JSON.parse(localStorage.getItem('luxury_cart') || '[]');
    setProducts(p);
    setCart(c);
  }, []);

  useEffect(() => {
    localStorage.setItem('luxury_cart', JSON.stringify(cart));
  }, [cart]);

  const money = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

  const totalBase = cart.reduce((a,i)=>a + i.price * i.quantity,0);
  const totalPix = totalBase * (1 - storeConfig.pixDiscount/100);
  const totalFinal = paymentMethod === 'pix' ? totalPix : totalBase;

  const addToCart = (p) => {
    const exists = cart.find(i => i.id === p.id);
    if(exists){
      setCart(cart.map(i => i.id === p.id ? {...i, quantity:i.quantity+1} : i));
    } else {
      setCart([...cart,{...p, quantity:1}]);
    }
    setIsCartOpen(true);
  };

  const updateQty = (id, delta) => {
    setCart(cart.map(i =>
      i.id === id ? {...i, quantity: Math.max(1, i.quantity + delta)} : i
    ));
  };

  const removeItem = id => setCart(cart.filter(i=>i.id!==id));

  const finalize = () => {
    if(sending) return;
    if(!customer.name || customer.phone.length < 10){
      alert('Preencha seus dados corretamente.');
      return;
    }

    setSending(true);

    const order = {
      id:'ORD-'+Date.now(),
      date:new Date().toLocaleString('pt-BR'),
      customer,
      items:cart,
      payment: paymentMethod === 'pix' ? 'PIX' : `${installment}x Cartão`,
      total: totalFinal
    };

    const saved = JSON.parse(localStorage.getItem('luxury_orders') || '[]');
    localStorage.setItem('luxury_orders', JSON.stringify([order,...saved]));

    const phone = storeConfig.whatsapp.replace(/\D/g,'');
    const msg = `
Pedido - ${storeConfig.name}

Cliente: ${customer.name}
Itens:
${cart.map(i=>`${i.quantity}x ${i.name} (${i.sku})`).join('\n')}

Pagamento: ${order.payment}
Total: ${money(totalFinal)}

Obs: ${customer.notes || 'Nenhuma'}
`;

    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`,'_blank');

    setTimeout(()=>{
      setCart([]);
      setStep('success');
      setSending(false);
    },800);
  };

  return (
  <div>

    <header className="bg-white border-b lux-border py-6 px-6 flex justify-between items-center sticky top-0 z-40">
      <div></div>
      <h1 className="font-serif tracking-[0.4em] uppercase">{storeConfig.name}</h1>
      <button onClick={()=>{setIsCartOpen(true);setStep('cart')}}>
        <Icon name="shopping-bag" size={24}/>
        {cart.length>0 && <span className="ml-2 text-xs font-bold">{cart.length}</span>}
      </button>
    </header>

    <main className="max-w-5xl mx-auto px-6 py-16 grid md:grid-cols-2 gap-12">
      {products.length===0 && <p>Catálogo em atualização</p>}
      {products.map(p=>(
        <div key={p.id} className="border-b lux-border pb-10 text-center">
          <img src={p.image} className="w-full aspect-square object-cover mb-6"/>
          <h3 className="font-serif uppercase">{p.name}</h3>
          <p className="text-xs text-gray-400">SKU: {p.sku}</p>
          <p className="lux-gold font-bold mt-2">PIX: {money(p.price*(1-storeConfig.pixDiscount/100))}</p>
          <button onClick={()=>addToCart(p)} className="mt-4 bg-black text-white py-3 w-full text-xs uppercase tracking-widest">
            Adicionar à Sacola
          </button>
        </div>
      ))}
    </main>

    {isCartOpen && (
    <div className="fixed inset-0 z-50">
      <div className="cart-overlay" onClick={()=>step!=='success' && setIsCartOpen(false)}></div>
      <div className="absolute right-0 top-0 h-full w-full max-w-md bg-white p-8 z-60 flex flex-col">

        {step==='cart' && (
        <>
          <h2 className="font-serif mb-6">Sacola</h2>
          <div className="flex-grow space-y-4 overflow-y-auto">
            {cart.map(i=>(
              <div key={i.id} className="flex items-center gap-3 border-b pb-3">
                <img src={i.image} className="w-12 h-12"/>
                <div className="flex-grow text-xs">{i.name}</div>
                <div className="flex items-center gap-2">
                  <button onClick={()=>updateQty(i.id,-1)}>-</button>
                  <span>{i.quantity}</span>
                  <button onClick={()=>updateQty(i.id,1)}>+</button>
                </div>
                <button onClick={()=>removeItem(i.id)}><Icon name="trash-2"/></button>
              </div>
            ))}
          </div>
          <button onClick={()=>setStep('checkout')} className="mt-6 bg-black text-white py-4 text-xs uppercase">
            Finalizar
          </button>
        </>
        )}

        {step==='checkout' && (
        <>
          <input placeholder="Nome" className="border-b mb-4" onChange={e=>setCustomer({...customer,name:e.target.value})}/>
          <input placeholder="WhatsApp" className="border-b mb-4" onChange={e=>setCustomer({...customer,phone:e.target.value})}/>
          <textarea placeholder="Observações" className="border p-2 mb-4" onChange={e=>setCustomer({...customer,notes:e.target.value})}></textarea>

          <button onClick={finalize} disabled={sending} className="bg-black text-white py-4">
            {sending ? 'Enviando...' : 'Finalizar via WhatsApp'}
          </button>
        </>
        )}

        {step==='success' && (
        <div className="flex flex-col items-center justify-center h-full text-center">
          <Icon name="check" size={48}/>
          <p className="mt-4">Pedido enviado com sucesso!</p>
          <button onClick={()=>setIsCartOpen(false)} className="mt-6 border px-6 py-3">
            Voltar à loja
          </button>
        </div>
        )}

      </div>
    </div>
    )}

  </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
