<!-- ARQUIVO: admin.html (Evoluído: Upload, Editar, PDF base) -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel Administrativo</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-[#FDFBF7]">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

function Admin(){
  const [store,setStore]=useState({name:'Nome da Loja',whatsapp:'',pixDiscount:0,maxInstallments:12});
  const [products,setProducts]=useState([]);
  const [orders,setOrders]=useState([]);
  const [editing,setEditing]=useState(null);
  const empty={name:'',sku:'',price:'',image:''};
  const [form,setForm]=useState(empty);

  useEffect(()=>{
    const s=localStorage.getItem('store');
    const p=localStorage.getItem('products');
    const o=localStorage.getItem('orders');
    if(s) setStore(JSON.parse(s));
    if(p) setProducts(JSON.parse(p));
    if(o) setOrders(JSON.parse(o));
  },[]);

  const saveStore=(d)=>{setStore(d);localStorage.setItem('store',JSON.stringify(d));}

  const uploadImage=(file)=>{
    const reader=new FileReader();
    reader.onload=e=>setForm({...form,image:e.target.result});
    reader.readAsDataURL(file);
  }

  const saveProduct=()=>{
    if(!form.name||!form.price) return;
    let list;
    if(editing){
      list=products.map(p=>p.id===editing?{...form,id:editing,price:+form.price}:p);
    } else {
      list=[...products,{...form,id:Date.now(),price:+form.price}];
    }
    setProducts(list);
    localStorage.setItem('products',JSON.stringify(list));
    setForm(empty);setEditing(null);
  }

  const edit=(p)=>{setForm(p);setEditing(p.id)}
  const del=(id)=>{const l=products.filter(p=>p.id!==id);setProducts(l);localStorage.setItem('products',JSON.stringify(l));}

  const format=v=>v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

  const printOrder=(o)=>{
    const w=window.open('','_blank');
    w.document.write(`<h2>${store.name}</h2><p>Cliente: ${o.customer.name}</p><p>Total: ${format(o.total)}</p>`);
    w.print();
  }

  const whats=(o)=>{
    const msg=`Pedido ${store.name} - ${o.customer.name} Total ${format(o.total)}`;
    window.open(`https://wa.me/${store.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
  }

  return(
    <div className="max-w-3xl mx-auto p-6 space-y-10 text-sm">
      <h1 className="text-center uppercase tracking-widest">Painel Administrativo</h1>

      <section className="bg-white border p-6 space-y-3">
        <h2 className="text-xs tracking-widest uppercase">Dados da Loja</h2>
        <input className="border-b p-2" placeholder="Nome" value={store.name} onChange={e=>saveStore({...store,name:e.target.value})}/>
        <input className="border-b p-2" placeholder="WhatsApp" value={store.whatsapp} onChange={e=>saveStore({...store,whatsapp:e.target.value})}/>
        <div className="grid grid-cols-2 gap-4">
          <input type="number" className="border p-2" placeholder="PIX %" value={store.pixDiscount} onChange={e=>saveStore({...store,pixDiscount:+e.target.value})}/>
          <input type="number" className="border p-2" placeholder="Parcelas" value={store.maxInstallments} onChange={e=>saveStore({...store,maxInstallments:+e.target.value})}/>
        </div>
      </section>

      <section className="bg-white border p-6 space-y-3">
        <h2 className="text-xs tracking-widest uppercase">Produto</h2>
        <input className="border-b p-2" placeholder="Nome" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/>
        <input className="border-b p-2" placeholder="SKU" value={form.sku} onChange={e=>setForm({...form,sku:e.target.value})}/>
        <input type="number" className="border-b p-2" placeholder="Preço" value={form.price} onChange={e=>setForm({...form,price:e.target.value})}/>
        <input type="file" onChange={e=>uploadImage(e.target.files[0])}/>
        {form.image && <img src={form.image} className="h-24"/>}
        <button onClick={saveProduct} className="bg-black text-white py-3 w-full">{editing?'Salvar Alterações':'Adicionar Produto'}</button>

        {products.map(p=>(
          <div key={p.id} className="flex justify-between items-center border p-3">
            <span>{p.name}</span>
            <div className="flex gap-3">
              <button onClick={()=>edit(p)}>Editar</button>
              <button onClick={()=>del(p.id)} className="text-red-500">Excluir</button>
            </div>
          </div>
        ))}
      </section>

      <section className="bg-white border p-6 space-y-3">
        <h2 className="text-xs tracking-widest uppercase">Pedidos</h2>
        {orders.length===0 && <p className="text-gray-400">Nenhum pedido</p>}
        {orders.map(o=>(
          <div key={o.id} className="border p-3 flex justify-between">
            <span>{o.customer.name} - {format(o.total)}</span>
            <div className="flex gap-3">
              <button onClick={()=>printOrder(o)}>PDF</button>
              <button onClick={()=>whats(o)} className="text-green-600">WhatsApp</button>
            </div>
          </div>
        ))}
      </section>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<Admin/>);
</script>
  <script>
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('./sw.js');
}
</script>
</body>
</html>
