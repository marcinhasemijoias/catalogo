<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Royal Joias</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f8fafc; color: #1e293b; }
        .card { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        input { border-bottom: 1px solid #cbd5e1; outline: none; width: 100%; padding: 5px 0; }
        input:focus { border-bottom-color: #a68966; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [config, setConfig] = useState({
                name: 'Royal Joias',
                whatsapp: '',
                pixDiscount: 10,
                maxInstallments: 12
            });
            const [newProd, setNewProd] = useState({ name: '', price: '', sku: '', image: '' });

            useEffect(() => {
                const p = localStorage.getItem('luxury_products');
                const o = localStorage.getItem('luxury_orders');
                const c = localStorage.getItem('luxury_config');
                if(p) setProducts(JSON.parse(p));
                if(o) setOrders(JSON.parse(o));
                if(c) setConfig(JSON.parse(c));
                
                // Inicializa ícones do Lucide
                if(window.lucide) window.lucide.createIcons();
            }, []);

            // Salva configurações automaticamente ao mudar
            const updateConfig = (field, value) => {
                const newConfig = { ...config, [field]: value };
                setConfig(newConfig);
                localStorage.setItem('luxury_config', JSON.stringify(newConfig));
            };

            // Função de Upload de Imagem (Converte para Base64)
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setNewProd({ ...newProd, image: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };

            const addProduct = (e) => {
                e.preventDefault();
                const updated = [...products, { ...newProd, id: Date.now(), price: parseFloat(newProd.price) }];
                setProducts(updated);
                localStorage.setItem('luxury_products', JSON.stringify(updated));
                setNewProd({ name: '', price: '', sku: '', image: '' });
                alert("Produto salvo com sucesso!");
            };

            // Romaneio Idêntico ao modelo Abella Joias (PDF 2162)
            const printReceipt = (order) => {
                const win = window.open('', '_blank');
                const content = `
                    <div style="font-family: Arial, sans-serif; max-width: 400px; margin: auto; padding: 20px;">
                        <div style="text-align: center; text-transform: uppercase;">
                            <h2 style="margin:0; letter-spacing: 3px;">${config.name}</h2>
                            <div style="font-size: 10px; margin-top: 5px;">ALTA JOALHARIA & DESIGN</div>
                            <div style="border-top: 1px solid #000; border-bottom: 1px solid #000; margin: 15px 0; padding: 5px; font-weight: bold; font-size: 14px;">DOCUMENTO DE VENDA</div>
                            <div style="font-size: 12px; text-align: left;">
                                Nº do Registro: ${order.id.toString().slice(-4)}<br>
                                Data: ${order.date || new Date().toLocaleString()}
                            </div>
                        </div>
                        <div style="margin-top: 20px; font-size: 12px;">
                            <strong>DESTINATARIO</strong><br>
                            ${(order.customer?.name || 'Não informado').toUpperCase()}<br>
                            ${order.customer?.phone || ''}
                        </div>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 11px;">
                            <thead>
                                <tr style="border-bottom: 1px solid #000; text-align: left;">
                                    <th style="padding-bottom: 5px;">DESCRIÇÃO DA PEÇA</th>
                                    <th style="padding-bottom: 5px;">QTD</th>
                                    <th style="padding-bottom: 5px; text-align: right;">SUBTOTAL</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.items?.map(item => `
                                    <tr>
                                        <td style="padding: 10px 0;">${item.name.toUpperCase()}<br><small>SKU: ${item.sku}</small></td>
                                        <td>1</td>
                                        <td style="text-align: right;">R$ ${parseFloat(item.price).toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div style="border-top: 1px solid #000; margin-top: 10px; padding-top: 10px; text-align: right;">
                            <div style="font-size: 12px;">Subtotal: R$ ${order.total?.toFixed(2)}</div>
                            <div style="font-size: 18px; font-weight: bold; margin-top: 5px;">TOTAL: R$ ${order.total?.toFixed(2)}</div>
                        </div>
                        <div style="margin-top: 20px; font-size: 12px;">
                            <strong>Forma de pagamento:</strong><br>
                            ${order.paymentMethod || 'A consultar'}
                        </div>
                        <div style="margin-top: 40px; text-align: center; font-size: 10px; font-style: italic;">
                            Obrigado por escolher a excelência. Este documento comprova a autenticidade da sua transação.
                        </div>
                    </div>
                `;
                win.document.write('<html><head><title>Romaneio</title></head><body>' + content + '</body></html>');
                win.document.close();
                setTimeout(() => { win.print(); }, 500);
            };

            return (
                <div className="max-w-4xl mx-auto p-6">
                    <header className="flex justify-between items-center mb-10 border-b pb-4">
                        <h1 className="text-xl font-bold tracking-widest uppercase">Admin Royal Joias</h1>
                        <button onClick={() => window.location.href='index.html'} className="text-xs font-bold border-b border-black">VER LOJA</button>
                    </header>

                    {/* CONFIGURAÇÕES DE VENDA */}
                    <div className="card">
                        <h2 className="text-xs font-bold uppercase mb-6 text-gray-400 tracking-widest">Configurações de Pagamento</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="text-[10px] uppercase font-bold">Desconto PIX (%)</label>
                                <input type="number" value={config.pixDiscount} onChange={(e) => updateConfig('pixDiscount', e.target.value)} />
                            </div>
                            <div>
                                <label className="text-[10px] uppercase font-bold">Parcelas Máximas</label>
                                <input type="number" value={config.maxInstallments} onChange={(e) => updateConfig('maxInstallments', e.target.value)} />
                            </div>
                        </div>
                    </div>

                    {/* CADASTRO DE PRODUTOS COM UPLOAD */}
                    <div className="card">
                        <h2 className="text-xs font-bold uppercase mb-6 text-gray-400 tracking-widest">Novo Produto</h2>
                        <form onSubmit={addProduct} className="space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input placeholder="Nome da Joia" value={newProd.name} onChange={e => setNewProd({...newProd, name: e.target.value})} required />
                                <input placeholder="Preço" type="number" step="0.01" value={newProd.price} onChange={e => setNewProd({...newProd, price: e.target.value})} required />
                                <input placeholder="SKU" value={newProd.sku} onChange={e => setNewProd({...newProd, sku: e.target.value})} />
                            </div>
                            <div className="border-2 border-dashed border-gray-100 p-4 text-center">
                                <label className="text-xs cursor-pointer block">
                                    <span className="bg-gray-100 px-4 py-2 rounded">Selecionar Imagem do Produto</span>
                                    <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} />
                                </label>
                                {newProd.image && <img src={newProd.image} className="h-20 mx-auto mt-2 rounded" />}
                            </div>
                            <button className="w-full bg-black text-white py-3 rounded text-xs font-bold uppercase tracking-widest">Salvar Produto</button>
                        </form>
                    </div>

                    {/* HISTÓRICO DE PEDIDOS */}
                    <div className="card">
                        <h2 className="text-xs font-bold uppercase mb-6 text-gray-400 tracking-widest">Histórico de Pedidos</h2>
                        <div className="overflow-x-auto">
                            <table className="w-full text-xs text-left">
                                <thead className="border-b">
                                    <tr>
                                        <th className="py-2">Data</th>
                                        <th className="py-2">Cliente</th>
                                        <th className="py-2">Total</th>
                                        <th className="py-2 text-right">Ações</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y">
                                    {orders.map(order => (
                                        <tr key={order.id}>
                                            <td className="py-4">{order.date || '---'}</td>
                                            <td className="py-4 font-bold">{order.customer?.name?.toUpperCase()}</td>
                                            <td className="py-4">R$ {order.total?.toFixed(2)}</td>
                                            <td className="py-4 text-right space-x-2">
                                                <button onClick={() => window.open(`https://wa.me/${order.customer?.phone?.replace(/\D/g,'')}`)} className="bg-green-500 text-white p-2 rounded">Zap</button>
                                                <button onClick={() => printReceipt(order)} className="bg-blue-500 text-white p-2 rounded">PDF</button>
                                                <button onClick={() => {
                                                    const updated = orders.filter(o => o.id !== order.id);
                                                    setOrders(updated);
                                                    localStorage.setItem('luxury_orders', JSON.stringify(updated));
                                                }} className="bg-red-500 text-white p-2 rounded">X</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            {orders.length === 0 && <p className="text-center py-6 text-gray-400 italic">Nenhum pedido encontrado.</p>}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
