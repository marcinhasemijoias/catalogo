<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abella Joias - Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600;700&display=swap');
body { font-family: 'Inter', sans-serif; background-color: #FDFBF7; }
.font-serif { font-family: 'Playfair Display', serif; }
.product-img { object-fit: contain; width: 100%; height: 200px; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;
const { jsPDF } = window.jspdf;

const Icons = {
  Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
  WhatsApp: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16.11 14.07a5.4 5.4 0 0 1-2.51.68c-.6 0-1.18-.06-1.73-.18l-1.29-.3-1.21.84.32-1.28-.31-1.3a5.38 5.38 0 0 1-.17-1.72 5.4 5.4 0 0 1 8.96-4.26 5.39 5.39 0 0 1 1.57 6.68z"/></svg>
};

function AdminApp(){
  const [products,setProducts]=useState([]);
  const [storeConfig,setStoreConfig]=useState({name:'Abella Joias',whatsapp:'5511999999999',pixDiscount:0.1,cardInstallments:3});
  const [orders,setOrders]=useState([]);
  const [newProduct,setNewProduct]=useState({id:null,name:'',price:'',stock:'',image:null});

  useEffect(()=>{
    const savedProducts=JSON.parse(localStorage.getItem('products')||'[]');
    const savedConfig=JSON.parse(localStorage.getItem('storeConfig')||'null');
    const savedOrders=JSON.parse(localStorage.getItem('orders')||'[]');
    if(savedProducts.length)setProducts(savedProducts);
    if(savedConfig)setStoreConfig(savedConfig);
    if(savedOrders.length)setOrders(savedOrders);
  },[]);

  const handleSaveProduct=()=>{
    if(!newProduct.name||!newProduct.price)return alert('Preencha nome e preço');
    const product={...newProduct,id:newProduct.id||Date.now()};
    const updated=products.filter(p=>p.id!==product.id);
    updated.push(product);
    setProducts(updated);
    localStorage.setItem('products',JSON.stringify(updated));
    setNewProduct({id:null,name:'',price:'',stock:'',image:null});
  };

  const handleDeleteProduct=id=>{
    const updated=products.filter(p=>p.id!==id);
    setProducts(updated);
    localStorage.setItem('products',JSON.stringify(updated));
  };

  const handleImageUpload=e=>{
    const file=e.target.files[0];
    if(!file)return;
    const reader=new FileReader();
    reader.onload=ev=>setNewProduct({...newProduct,image:ev.target.result});
    reader.readAsDataURL(file);
  };

  const saveConfig=()=>{
    localStorage.setItem('storeConfig',JSON.stringify(storeConfig));
    alert('Configurações salvas!');
  };

  const generatePDF=order=>{
    const doc=new jsPDF();
    doc.setFontSize(16);
    doc.text(`Romaneio Pedido #${order.id}`,10,10);
    doc.setFontSize(12);
    doc.text(`Cliente: ${order.customer.name}`,10,20);
    doc.text(`WhatsApp: ${order.customer.phone}`,10,28);
    doc.text(`Forma de pagamento: ${order.payment}`,10,36);
    doc.text('Itens:',10,44);
    order.items.forEach((i,index)=>{
      doc.text(`${i.qty}x ${i.name} - ${Number(i.price).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}`,12,52+index*8);
    });
    doc.text(`Total: ${Number(order.total).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}`,10,60+order.items.length*8);
    doc.save(`Romaneio_${order.id}.pdf`);
  };

  const sendWhatsAppCustomer=order=>{
    if(!order.customer.phone)return;
    const itemsList=order.items.map(i=>`- ${i.qty}x ${i.name}`).join('%0A');
    const msg=`*Pedido #${order.id}*%0ACliente: ${order.customer.name}%0AItens:%0A${itemsList}%0ATotal: ${Number(order.total).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}%0APagamento: ${order.payment}`;
    window.open(`https://wa.me/${order.customer.phone.replace(/\D/g,'')}?text=${msg}`,'_blank');
  };

  return (
    <div className="p-6 max-w-5xl mx-auto space-y-8">
      <h1 className="text-3xl font-serif mb-4">Admin - Abella Joias</h1>

      <section className="space-y-4">
        <h2 className="text-xl font-bold">Configurações da Loja</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input className="border p-2 w-full" placeholder="Nome da Loja" value={storeConfig.name} onChange={e=>setStoreConfig({...storeConfig,name:e.target.value})}/>
          <input className="border p-2 w-full" placeholder="WhatsApp da Loja" value={storeConfig.whatsapp} onChange={e=>setStoreConfig({...storeConfig,whatsapp:e.target.value})}/>
          <input className="border p-2 w-full" type="number" placeholder="Desconto PIX (0-1)" value={storeConfig.pixDiscount} onChange={e=>setStoreConfig({...storeConfig,pixDiscount:parseFloat(e.target.value)})}/>
          <input className="border p-2 w-full" type="number" placeholder="Parcelas Cartão" value={storeConfig.cardInstallments} onChange={e=>setStoreConfig({...storeConfig,cardInstallments:parseInt(e.target.value)})}/>
        </div>
        <button onClick={saveConfig} className="bg-[#A68966] text-white px-4 py-2 rounded-sm mt-2">Salvar Configurações</button>
      </section>

      <section className="space-y-4">
        <h2 className="text-xl font-bold">Produtos</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {products.map(p=>(
            <div key={p.id} className="border p-2 rounded-sm relative">
              {p.image && <img src={p.image} className="product-img mb-2" alt={p.name}/>}
              <p className="font-bold">{p.name}</p>
              <p>R$ {Number(p.price).toFixed(2)}</p>
              <p>Estoque: {p.stock}</p>
              <div className="flex gap-2 mt-2">
                <button onClick={()=>setNewProduct({...p})} className="bg-blue-500 text-white px-2 py-1 rounded-sm">Editar</button>
                <button onClick={()=>handleDeleteProduct(p.id)} className="bg-red-500 text-white px-2 py-1 rounded-sm">Excluir</button>
              </div>
            </div>
          ))}
        </div>

        <div className="border p-4 rounded-sm space-y-2">
          <h3 className="font-bold">{newProduct.id?'Editar Produto':'Adicionar Produto'}</h3>
          <input className="border p-2 w-full" placeholder="Nome" value={newProduct.name} onChange={e=>setNewProduct({...newProduct,name:e.target.value})}/>
          <input className="border p-2 w-full" type="number" placeholder="Preço" value={newProduct.price} onChange={e=>setNewProduct({...newProduct,price:e.target.value})}/>
          <input className="border p-2 w-full" type="number" placeholder="Estoque" value={newProduct.stock} onChange={e=>setNewProduct({...newProduct,stock:e.target.value})}/>
          <input type="file" onChange={handleImageUpload} className="w-full"/>
          <button onClick={handleSaveProduct} className="bg-[#2D2926] text-white px-4 py-2 rounded-sm">{newProduct.id?'Salvar Alterações':'Salvar Produto'}</button>
        </div>
      </section>

      <section className="space-y-4">
        <h2 className="text-xl font-bold">Relatório de Vendas</h2>
        {orders.length===0?<p>Nenhum pedido registrado ainda.</p>:(
          <div className="space-y-2">
            {orders.map(order=>(
              <div key={order.id} className="border p-2 rounded-sm space-y-1">
                <p><strong>ID:</strong> {order.id} | <strong>Cliente:</strong> {order.customer.name} | <strong>Total:</strong> {Number(order.total).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})} | <strong>Pagamento:</strong> {order.payment}</p>
                <button onClick={()=>generatePDF(order)} className="bg-[#A68966] text-white px-3 py-1 rounded-sm mr-2">Gerar PDF</button>
                {order.customer.phone && <button onClick={()=>sendWhatsAppCustomer(order)} className="bg-green-500 text-white px-3 py-1 rounded-sm">WhatsApp Cliente</button>}
              </div>
            ))}
          </div>
        )}
      </section>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<AdminApp/>);
</script>
</body>
</html>

