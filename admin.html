<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Royal Joias</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #FDFBF7; color: #2D2926; }
        .lux-card { background: white; border: 1px solid #E5DACE; border-radius: 2px; }
        input { border-bottom: 1px solid #E5DACE !important; outline: none; background: transparent; }
        input:focus { border-bottom-color: #A68966 !important; }
        .product-img-preview { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; background: #f5f5f5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{width: size, height: size}} className={`inline-block ${className}`}></i>;
        };

        function App() {
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [storeConfig, setStoreConfig] = useState({ name: 'Royal Joias', whatsapp: '', pixDiscount: 0.1 });
            const [newProduct, setNewProduct] = useState({ sku: '', name: '', price: '', image: '' });

            useEffect(() => {
                const savedProducts = localStorage.getItem('luxury_products');
                const savedConfig = localStorage.getItem('luxury_config');
                const savedOrders = localStorage.getItem('luxury_orders');
                
                if (savedProducts) setProducts(JSON.parse(savedProducts));
                if (savedConfig) setStoreConfig(JSON.parse(savedConfig));
                if (savedOrders) setOrders(JSON.parse(savedOrders));
            }, []);

            const formatCurrency = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            // GERENCIAMENTO DE PRODUTOS
            const handleAddProduct = (e) => {
                e.preventDefault();
                if (!newProduct.name || !newProduct.price) return;
                const newList = [...products, { ...newProduct, id: Date.now(), price: parseFloat(newProduct.price) }];
                setProducts(newList);
                localStorage.setItem('luxury_products', JSON.stringify(newList));
                setNewProduct({ sku: '', name: '', price: '', image: '' });
            };

            const deleteProduct = (id) => {
                const newList = products.filter(p => p.id !== id);
                setProducts(newList);
                localStorage.setItem('luxury_products', JSON.stringify(newList));
            };

            // GERENCIAMENTO DE PEDIDOS
            const deleteOrder = (id) => {
                if(window.confirm("Atenção: Deseja realmente excluir este pedido do histórico?")) {
                    const newOrders = orders.filter(o => o.id !== id);
                    setOrders(newOrders);
                    localStorage.setItem('luxury_orders', JSON.stringify(newOrders));
                }
            };

            const handleDownloadPdf = (order) => {
                const element = document.createElement('div');
                element.innerHTML = `
                    <div style="padding: 40px; font-family: serif; border: 1px solid #eee;">
                        <h1 style="text-transform: uppercase;">${storeConfig.name}</h1>
                        <p><strong>Recibo de Venda:</strong> #${order.id}</p>
                        <hr/>
                        <p><strong>Cliente:</strong> ${order.customer?.name || order.cliente}</p>
                        <p><strong>WhatsApp:</strong> ${order.customer?.phone || order.whatsapp}</p>
                        <p><strong>Data:</strong> ${order.date || order.data}</p>
                        <p><strong>Total:</strong> ${formatCurrency(order.total)}</p>
                    </div>
                `;
                html2pdf().from(element).set({ margin: 10, filename: `Romaneio_${order.id}.pdf` }).save();
            };

            return (
                <div className="min-h-screen pb-20">
                    <header className="bg-white border-b border-[#E5DACE] px-6 py-4 flex justify-between items-center shadow-sm sticky top-0 z-50">
                        <div className="flex items-center gap-3">
                            <Icon name="settings" className="text-[#A68966]" />
                            <h1 className="text-sm tracking-[0.3em] uppercase font-bold">Admin Royal Joias</h1>
                        </div>
                        <button onClick={() => window.location.href='index.html'} className="text-[10px] font-bold uppercase border-b border-black">Acessar Loja</button>
                    </header>

                    <main className="max-w-3xl mx-auto p-6 space-y-10">
                        
                        {/* 1. HISTÓRICO DE PEDIDOS */}
                        <section className="lux-card p-6 shadow-sm">
                            <h2 className="text-xs font-black uppercase tracking-widest mb-6 border-l-2 border-[#A68966] pl-3 flex items-center gap-2">
                                <Icon name="history" size={16}/> Histórico de Pedidos
                            </h2>
                            <div className="space-y-3">
                                {orders.length === 0 ? (
                                    <p className="text-xs italic text-gray-400">Nenhum pedido registrado.</p>
                                ) : (
                                    orders.map(order => (
                                        <div key={order.id} className="p-4 border border-gray-100 flex justify-between items-center bg-[#FDFBF7] hover:border-[#A68966] transition-all">
                                            <div className="text-[10px]">
                                                <p className="font-bold text-sm uppercase">{order.customer?.name || order.cliente}</p>
                                                <p className="text-gray-400 font-medium">{order.date || order.data} • <span className="text-[#A68966] font-bold">{formatCurrency(order.total)}</span></p>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => window.open(`https://wa.me/${(order.customer?.phone || order.whatsapp || "").replace(/\D/g, "")}`, '_blank')} className="p-2 bg-[#25D366] text-white rounded hover:opacity-80" title="WhatsApp">
                                                    <Icon name="message-circle" size={16}/>
                                                </button>
                                                <button onClick={() => handleDownloadPdf(order)} className="p-2 bg-white border border-[#E5DACE] text-gray-600 rounded hover:bg-gray-50" title="PDF">
                                                    <Icon name="file-text" size={16}/>
                                                </button>
                                                <button onClick={() => deleteOrder(order.id)} className="p-2 bg-red-50 text-red-500 rounded hover:bg-red-100" title="Excluir">
                                                    <Icon name="trash-2" size={16}/>
                                                </button>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </section>

                        {/* 2. CONFIGURAÇÕES DA EMPRESA */}
                        <section className="lux-card p-6 shadow-sm">
                            <h2 className="text-xs font-black uppercase tracking-widest mb-6 border-l-2 border-[#A68966] pl-3 flex items-center gap-2">
                                <Icon name="store" size={16}/> Dados da Empresa
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-1">
                                    <label className="text-[9px] uppercase font-bold text-gray-400">Nome Comercial</label>
                                    <input className="w-full py-2 text-sm" value={storeConfig.name} onChange={e => {
                                        const c = {...storeConfig, name: e.target.value};
                                        setStoreConfig(c);
                                        localStorage.setItem('luxury_config', JSON.stringify(c));
                                    }} />
                                </div>
                                <div className="space-y-1">
                                    <label className="text-[9px] uppercase font-bold text-gray-400">WhatsApp de Vendas</label>
                                    <input className="w-full py-2 text-sm" value={storeConfig.whatsapp} onChange={e => {
                                        const c = {...storeConfig, whatsapp: e.target.value};
                                        setStoreConfig(c);
                                        localStorage.setItem('luxury_config', JSON.stringify(c));
                                    }} />
                                </div>
                            </div>
                        </section>

                        {/* 3. CADASTRO DE PRODUTOS COM IMAGEM */}
                        <section className="lux-card p-6 shadow-sm">
                            <h2 className="text-xs font-black uppercase tracking-widest mb-6 border-l-2 border-[#A68966] pl-3 flex items-center gap-2">
                                <Icon name="plus-circle" size={16}/> Cadastrar Produto
                            </h2>
                            <form onSubmit={handleAddProduct} className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input className="py-2 text-sm" placeholder="Nome da Peça" value={newProduct.name} onChange={e => setNewProduct({...newProduct, name: e.target.value})} />
                                    <input className="py-2 text-sm" placeholder="URL da Imagem (Link)" value={newProduct.image} onChange={e => setNewProduct({...newProduct, image: e.target.value})} />
                                    <input className="py-2 text-sm" placeholder="SKU / Referência" value={newProduct.sku} onChange={e => setNewProduct({...newProduct, sku: e.target.value})} />
                                    <input className="py-2 text-sm" placeholder="Preço Base (Ex: 1500)" type="number" step="0.01" value={newProduct.price} onChange={e => setNewProduct({...newProduct, price: e.target.value})} />
                                </div>
                                <button className="w-full bg-[#2D2926] text-white py-3 text-[10px] uppercase tracking-widest font-bold hover:bg-black transition-all">
                                    Salvar no Catálogo
                                </button>
                            </form>

                            <div className="mt-10 border-t pt-6 space-y-3">
                                <p className="text-[10px] uppercase font-black text-gray-400 mb-4 tracking-widest">Produtos Ativos</p>
                                {products.map(p => (
                                    <div key={p.id} className="flex justify-between items-center p-3 border border-gray-50 hover:bg-gray-50 transition-all">
                                        <div className="flex items-center gap-4">
                                            <img src={p.image || 'https://via.placeholder.com/50'} className="product-img-preview" alt={p.name} />
                                            <div>
                                                <p className="text-xs font-bold uppercase">{p.name}</p>
                                                <p className="text-[10px] text-gray-400 font-mono">#{p.sku}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-6">
                                            <span className="font-bold text-sm text-[#A68966]">{formatCurrency(p.price)}</span>
                                            <button onClick={() => deleteProduct(p.id)} className="text-red-300 hover:text-red-500">
                                                <Icon name="trash-2" size={16}/>
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>

                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
