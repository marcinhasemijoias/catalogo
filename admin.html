<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#FDFBF7] text-[#2D2926]">

<header class="bg-white border-b px-6 py-4 flex justify-between">
<h1 class="text-sm tracking-[0.4em] uppercase">Painel Administrativo</h1>
<a href="./" class="text-xs text-[#A68966]">Ver Loja</a>
</header>

<main class="max-w-3xl mx-auto p-6 space-y-10">

<!-- CONFIG LOJA -->
<section class="bg-white border p-6 space-y-4">
<h2 class="text-xs uppercase tracking-widest border-l-2 pl-3 border-[#A68966]">Dados da Loja</h2>

<input id="storeName" class="w-full border-b p-2" placeholder="Nome da Loja">
<input id="storeWhatsapp" class="w-full border-b p-2" placeholder="WhatsApp (5511999999999)">
<input id="pixDiscount" type="number" class="w-full border-b p-2" placeholder="Desconto PIX (%)">
<input id="maxInstallments" type="number" class="w-full border-b p-2" placeholder="Parcelas máximas no cartão">

<button onclick="saveStore()" class="bg-black text-white px-4 py-2 text-xs uppercase">
Salvar Configurações
</button>
</section>

<!-- PRODUTO -->
<section class="bg-white border p-6 space-y-4">
<h2 class="text-xs uppercase tracking-widest border-l-2 pl-3 border-[#A68966]">Produto</h2>

<input id="prodName" class="w-full border-b p-2" placeholder="Nome">
<input id="prodSku" class="w-full border-b p-2" placeholder="SKU">
<input id="prodPrice" class="w-full border-b p-2" placeholder="Preço (ex: 12,50)">
<input id="prodImg" type="file" accept="image/*">

<button id="prodBtn" onclick="saveProduct()" class="bg-black text-white px-4 py-2 text-xs uppercase">
Adicionar Produto
</button>

<p id="prodMsg" class="text-xs text-red-600"></p>
</section>

<!-- PRODUTOS -->
<section class="bg-white border p-6">
<h2 class="text-xs uppercase tracking-widest border-l-2 pl-3 border-[#A68966]">Produtos</h2>
<div id="productList"></div>
</section>

</main>

<script>
const STORE_KEY = 'store_config';
const PRODUCT_KEY = 'store_products';

let editingId = null;

/* ===== LOJA ===== */
function saveStore(){
localStorage.setItem(STORE_KEY, JSON.stringify({
name: storeName.value,
whatsapp: storeWhatsapp.value,
pixDiscount: Number(pixDiscount.value),
maxInstallments: Number(maxInstallments.value)
}));
alert('Configurações salvas');
}

function loadStore(){
const s = JSON.parse(localStorage.getItem(STORE_KEY) || '{}');
storeName.value = s.name || '';
storeWhatsapp.value = s.whatsapp || '';
pixDiscount.value = s.pixDiscount || '';
maxInstallments.value = s.maxInstallments || '';
}

/* ===== PRODUTOS ===== */
function saveProduct(){
prodMsg.textContent = '';

if(!prodName.value || !prodPrice.value){
prodMsg.textContent = 'Preencha nome e preço.';
return;
}

const price = Number(prodPrice.value.replace(',','.'));
if(isNaN(price)){
prodMsg.textContent = 'Preço inválido.';
return;
}

const products = JSON.parse(localStorage.getItem(PRODUCT_KEY) || '[]');

if(editingId){
const index = products.findIndex(p => p.id === editingId);
if(index !== -1){
products[index].name = prodName.value;
products[index].sku = prodSku.value;
products[index].price = price;

if(prodImg.files[0]){
const reader = new FileReader();
reader.onload = () => {
products[index].image = reader.result;
localStorage.setItem(PRODUCT_KEY, JSON.stringify(products));
resetForm();
renderProducts();
};
reader.readAsDataURL(prodImg.files[0]);
return;
}
}
} else {
if(!prodImg.files[0]){
prodMsg.textContent = 'Selecione uma imagem.';
return;
}
const reader = new FileReader();
reader.onload = () => {
products.push({
id: Date.now(),
name: prodName.value,
sku: prodSku.value,
price,
image: reader.result
});
localStorage.setItem(PRODUCT_KEY, JSON.stringify(products));
resetForm();
renderProducts();
};
reader.readAsDataURL(prodImg.files[0]);
return;
}

localStorage.setItem(PRODUCT_KEY, JSON.stringify(products));
resetForm();
renderProducts();
}

function editProduct(id){
const products = JSON.parse(localStorage.getItem(PRODUCT_KEY) || '[]');
const p = products.find(p => p.id === id);
if(!p) return;

editingId = id;
prodName.value = p.name;
prodSku.value = p.sku;
prodPrice.value = p.price.toString().replace('.',',');

prodBtn.textContent = 'Salvar Alterações';
window.scrollTo({top:0, behavior:'smooth'});
}

function deleteProduct(id){
if(!confirm('Excluir este produto?')) return;
const products = JSON.parse(localStorage.getItem(PRODUCT_KEY) || '[]')
.filter(p => p.id !== id);
localStorage.setItem(PRODUCT_KEY, JSON.stringify(products));
renderProducts();
}

function resetForm(){
editingId = null;
prodName.value = '';
prodSku.value = '';
prodPrice.value = '';
prodImg.value = '';
prodBtn.textContent = 'Adicionar Produto';
}

function renderProducts(){
const products = JSON.parse(localStorage.getItem(PRODUCT_KEY) || '[]');
productList.innerHTML = '';
products.forEach(p => {
productList.innerHTML += `
<div class="flex justify-between items-center border-b py-2 text-xs">
<span>${p.name} — R$ ${p.price.toFixed(2)}</span>
<div class="flex gap-3">
<button onclick="editProduct(${p.id})" class="text-blue-600">Editar</button>
<button onclick="deleteProduct(${p.id})" class="text-red-600">Excluir</button>
</div>
</div>`;
});
}

/* INIT */
loadStore();
renderProducts();
</script>

</body>
</html>
