<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Royal Joias</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f9fafb; color: #1f2937; }
        .order-card { background: white; border: 1px solid #e5e7eb; transition: all 0.2s; }
        .order-card:hover { border-color: #A68966; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Componente de Ícone para garantir que carreguem sempre
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{width: size, height: size}} className={`inline-block ${className}`}></i>;
        };

        function AdminApp() {
            const [orders, setOrders] = useState([]);
            const [config, setConfig] = useState({ name: 'Royal Joias' });

            useEffect(() => {
                const savedOrders = JSON.parse(localStorage.getItem('luxury_orders') || '[]');
                const savedConfig = JSON.parse(localStorage.getItem('luxury_config') || '{"name":"Royal Joias"}');
                setOrders(savedOrders);
                setConfig(savedConfig);
            }, []);

            const formatMoney = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            const handleDelete = (id) => {
                if (window.confirm("Tem certeza que deseja excluir este pedido definitivamente?")) {
                    const filtered = orders.filter(o => o.id !== id);
                    localStorage.setItem('luxury_orders', JSON.stringify(filtered));
                    setOrders(filtered);
                }
            };

            const handlePrint = (order) => {
                const win = window.open('', '_blank');
                win.document.write(`
                    <html>
                        <head><title>Romaneio - ${order.cliente}</title></head>
                        <style>
                            body { font-family: sans-serif; padding: 40px; line-height: 1.6; }
                            .header { border-bottom: 2px solid #000; margin-bottom: 20px; padding-bottom: 10px; }
                            .item { border-bottom: 1px solid #eee; padding: 8px 0; }
                            .total { font-size: 20px; font-weight: bold; margin-top: 20px; }
                        </style>
                        <body>
                            <div class="header"><h1>${config.name}</h1><p>Romaneio de Pedido #${order.id}</p></div>
                            <p><strong>Data:</strong> ${order.data}</p>
                            <p><strong>Cliente:</strong> ${order.cliente}</p>
                            <p><strong>WhatsApp:</strong> ${order.whatsapp}</p>
                            <div class="item"><strong>Itens:</strong> ${order.itens}</div>
                            <p><strong>Pagamento:</strong> ${order.pagamento}</p>
                            <div class="total text-right">VALOR TOTAL: ${formatMoney(order.total)}</div>
                            <script>window.print();<\/script>
                        </body>
                    </html>
                `);
                win.document.close();
            };

            return (
                <div className="max-w-6xl mx-auto px-4 py-10">
                    <header className="flex justify-between items-center mb-10">
                        <div>
                            <h1 className="text-3xl font-bold tracking-tight">Gestão de Pedidos</h1>
                            <p className="text-gray-500">{config.name} - Histórico Administrativo</p>
                        </div>
                        <button onClick={() => window.location.href='index.html'} className="flex items-center gap-2 bg-black text-white px-6 py-2 rounded-full text-sm font-semibold hover:bg-gray-800">
                            <Icon name="layout-template" size={16} /> Ver Loja Online
                        </button>
                    </header>

                    <div className="grid gap-4">
                        {orders.length > 0 ? (
                            orders.map(order => (
                                <div key={order.id} className="order-card p-6 rounded-xl flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                    <div className="flex-grow">
                                        <div className="flex items-center gap-3 mb-1">
                                            <span className="text-[10px] font-bold bg-gray-100 px-2 py-0.5 rounded text-gray-500">{order.id}</span>
                                            <span className="text-xs text-gray-400">{order.data}</span>
                                        </div>
                                        <h2 className="text-lg font-bold text-gray-800 uppercase">{order.cliente}</h2>
                                        <p className="text-sm text-gray-500 italic mb-2">{order.itens}</p>
                                        <div className="flex items-center gap-4">
                                            <span className="text-xs font-bold text-gray-400 uppercase tracking-widest">{order.pagamento}</span>
                                            <span className="text-lg font-bold text-[#A68966]">{formatMoney(order.total)}</span>
                                        </div>
                                    </div>

                                    <div className="flex gap-2 w-full md:w-auto border-t md:border-0 pt-4 md:pt-0">
                                        {/* Botão WhatsApp */}
                                        <button 
                                            onClick={() => window.open(`https://wa.me/${order.whatsapp.replace(/\D/g, "")}`, '_blank')}
                                            className="flex-grow md:flex-none p-3 text-green-600 hover:bg-green-50 rounded-lg border border-green-100 flex justify-center items-center"
                                            title="Chamar no WhatsApp"
                                        >
                                            <Icon name="message-circle" size={20} />
                                        </button>

                                        {/* Botão Romaneio */}
                                        <button 
                                            onClick={() => handlePrint(order)}
                                            className="flex-grow md:flex-none p-3 text-blue-600 hover:bg-blue-50 rounded-lg border border-blue-100 flex justify-center items-center"
                                            title="Imprimir Romaneio"
                                        >
                                            <Icon name="printer" size={20} />
                                        </button>

                                        {/* Botão Excluir */}
                                        <button 
                                            onClick={() => handleDelete(order.id)}
                                            className="flex-grow md:flex-none p-3 text-red-500 hover:bg-red-50 rounded-lg border border-red-100 flex justify-center items-center"
                                            title="Remover Pedido"
                                        >
                                            <Icon name="trash-2" size={20} />
                                        </button>
                                    </div>
                                </div>
                            ))
                        ) : (
                            <div className="text-center py-20 bg-white rounded-2xl border border-dashed border-gray-300">
                                <Icon name="inbox" size={48} className="text-gray-200 mb-4" />
                                <p className="text-gray-400 italic">Nenhum pedido recebido até o momento.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminApp />);
    </script>
</body>
</html>
