<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Abella Joias</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600;700&display=swap');
body{font-family:'Inter',sans-serif;background:#FDFBF7;}
.font-serif{font-family:'Playfair Display',serif;}
.animate-in{animation:fadeIn 0.4s ease-out;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;
const Icons = {
  Trash2:()=> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
  Edit:()=> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
};

function Admin(){
  const [products,setProducts]=useState([]);
  const [orders,setOrders]=useState([]);
  const [store,setStore]=useState({name:'Abella Joias',whatsapp:'5511999999999',pixDiscount:0.1,cardInstallments:3});
  const [editing,setEditing]=useState(null);
  const [form,setForm]=useState({id:'',sku:'',name:'',price:'',stock:'',image:''});

  useEffect(()=>{
    const savedProducts=JSON.parse(localStorage.getItem('products')||'[]');
    const savedOrders=JSON.parse(localStorage.getItem('orders')||'[]');
    const savedStore=JSON.parse(localStorage.getItem('storeConfig')||'null');
    if(savedProducts)setProducts(savedProducts);
    if(savedOrders)setOrders(savedOrders);
    if(savedStore)setStore(savedStore);
  },[]);

  const saveStore=()=>{
    localStorage.setItem('storeConfig',JSON.stringify(store));
    alert("Configurações da empresa salvas!");
  }

  const handleImage=e=>{
    const file=e.target.files[0];
    const reader=new FileReader();
    reader.onload=ev=>setForm({...form,image:ev.target.result});
    reader.readAsDataURL(file);
  }

  const saveProduct=()=>{
    if(editing!==null){
      const updated=products.map(p=>p.id===editing?form:{...p,id:Date.now()});
      setProducts(updated);
      localStorage.setItem('products',JSON.stringify(updated));
      setEditing(null);
    } else {
      const newProd={...form,id:Date.now()};
      const updated=[...products,newProd];
      setProducts(updated);
      localStorage.setItem('products',JSON.stringify(updated));
    }
    setForm({id:'',sku:'',name:'',price:'',stock:'',image:''});
  }

  const editProduct=p=>{
    setForm(p);
    setEditing(p.id);
  }

  const deleteProduct=id=>{
    if(!confirm("Excluir este produto?"))return;
    const updated=products.filter(p=>p.id!==id);
    setProducts(updated);
    localStorage.setItem('products',JSON.stringify(updated));
  }

  const deleteOrder=id=>{
    if(!confirm("Excluir este pedido?"))return;
    const updated=orders.filter(o=>o.id!==id);
    setOrders(updated);
    localStorage.setItem('orders',JSON.stringify(updated));
  }

  const generatePDF=order=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({unit:'pt', format:'a4'});
    doc.setFont('Playfair Display','normal');
    doc.setFontSize(18);
    doc.text(store.name,40,50);
    doc.setFontSize(12);
    doc.text(`Pedido #${order.id}`,40,80);
    doc.text(`Cliente: ${order.customer.name}`,40,100);
    doc.text(`WhatsApp: ${order.customer.phone}`,40,120);
    doc.text(`Pagamento: ${order.payment}`,40,140);
    let y=170;
    order.items.forEach(i=>{
      doc.text(`SKU: ${i.sku} | ${i.name} x${i.qty} - ${i.price.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}`,40,y);
      y+=20;
    });
    doc.text(`Total: ${order.total.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}`,40,y+10);
    doc.save(`Pedido_${order.id}.pdf`);
  }

  return(
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-3xl font-serif mb-4">Painel Administrativo</h1>

      {/* Configuração da Empresa */}
      <section className="mb-8 bg-white p-4 rounded shadow space-y-3">
        <h2 className="font-serif text-xl mb-2">Configurações da Empresa</h2>
        <input className="w-full border-b py-2" placeholder="Nome da Loja" value={store.name} onChange={e=>setStore({...store,name:e.target.value})}/>
        <input className="w-full border-b py-2" placeholder="WhatsApp" value={store.whatsapp} onChange={e=>setStore({...store,whatsapp:e.target.value})}/>
        <input className="w-full border-b py-2" placeholder="Desconto PIX (0.1 = 10%)" type="number" step="0.01" value={store.pixDiscount} onChange={e=>setStore({...store,pixDiscount:parseFloat(e.target.value)})}/>
        <input className="w-full border-b py-2" placeholder="Parcelas Cartão" type="number" value={store.cardInstallments} onChange={e=>setStore({...store,cardInstallments:parseInt(e.target.value)})}/>
        <button onClick={saveStore} className="bg-[#A68966] text-white py-2 px-4 rounded mt-2">Salvar Configurações</button>
      </section>

      {/* Cadastro de Produto */}
      <section className="mb-8 bg-white p-4 rounded shadow space-y-3">
        <h2 className="font-serif text-xl mb-2">Cadastro de Produto</h2>
        <input className="w-full border-b py-2" placeholder="SKU" value={form.sku} onChange={e=>setForm({...form,sku:e.target.value})}/>
        <input className="w-full border-b py-2" placeholder="Nome do Produto" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/>
        <input className="w-full border-b py-2" placeholder="Preço" type="number" value={form.price} onChange={e=>setForm({...form,price:parseFloat(e.target.value)})}/>
        <input className="w-full border-b py-2" placeholder="Estoque" type="number" value={form.stock} onChange={e=>setForm({...form,stock:parseInt(e.target.value)})}/>
        <input type="file" accept="image/*" onChange={handleImage}/>
        {form.image&&<img src={form.image} className="w-32 h-32 object-contain mt-2"/>}
        <button onClick={saveProduct} className="bg-[#2D2926] text-white py-2 px-4 rounded">{editing!==null?'Atualizar Produto':'Adicionar Produto'}</button>
      </section>

      {/* Lista de Produtos */}
      <section className="mb-8 bg-white p-4 rounded shadow space-y-2">
        <h2 className="font-serif text-xl mb-2">Produtos Cadastrados</h2>
        {products.length===0?<p className="text-gray-400 italic">Nenhum produto cadastrado.</p>:(
          <div className="grid md:grid-cols-2 grid-cols-1 gap-3">
            {products.map(p=>(
              <div key={p.id} className="border p-2 rounded flex justify-between items-center">
                <div className="flex gap-2 items-center">
                  {p.image&&<img src={p.image} className="w-16 h-16 object-contain"/>}
                  <div>
                    <p className="font-bold">{p.name}</p>
                    <p className="text-xs">SKU: {p.sku}</p>
                    <p className="text-xs">R$: {p.price.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</p>
                  </div>
                </div>
                <div className="flex gap-1">
                  <button onClick={()=>editProduct(p)} className="p-1 border rounded"><Icons.Edit/></button>
                  <button onClick={()=>deleteProduct(p.id)} className="p-1 border rounded"><Icons.Trash2/></button>
                </div>
              </div>
            ))}
          </div>
        )}
      </section>

      {/* Relatório de Pedidos */}
      <section className="bg-white p-4 rounded shadow space-y-2">
        <h2 className="font-serif text-xl mb-2">Relatório de Pedidos</h2>
        {orders.length===0?<p className="text-gray-400 italic">Nenhum pedido realizado.</p>:(
          <div className="space-y-2">
            {orders.map(o=>(
              <div key={o.id} className="border p-2 rounded flex justify-between items-center">
                <div>
                  <p className="font-bold">Pedido #{o.id} - {o.customer.name}</p>
                  <p className="text-xs">Total: {o.total.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})} | Pagamento: {o.payment}</p>
                </div>
                <div className="flex gap-1">
                  <button onClick={()=>generatePDF(o)} className="px-2 py-1 bg-[#A68966] text-white rounded text-xs">Romaneio PDF</button>
                  <button onClick={()=>deleteOrder(o.id)} className="px-2 py-1 bg-red-500 text-white rounded text-xs">Excluir</button>
                </div>
              </div>
            ))}
          </div>
        )}
      </section>
    </div>
  )
}

ReactDOM.createRoot(document.getElementById('root')).render(<Admin/>);
</script>
</body>
</html>
