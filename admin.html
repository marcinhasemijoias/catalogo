<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Royal Joias - Administrativo</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }
        .receipt-print { font-family: 'Courier New', Courier, monospace; width: 80mm; padding: 10px; color: black; background: white; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{width: size, height: size}} className={`inline-block ${className}`}></i>;
        };

        function AdminApp() {
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [storeConfig, setStoreConfig] = useState({
                name: 'Royal Joias',
                whatsapp: '5511999999999',
                pixDiscount: 0.1,
                maxInstallments: 12
            });

            const [newProduct, setNewProduct] = useState({ sku: '', name: '', price: '', image: '' });

            useEffect(() => {
                const savedProducts = localStorage.getItem('luxury_products');
                const savedConfig = localStorage.getItem('luxury_config');
                const savedOrders = localStorage.getItem('luxury_orders');
                if (savedProducts) setProducts(JSON.parse(savedProducts));
                if (savedConfig) setStoreConfig(JSON.parse(savedConfig));
                if (savedOrders) setOrders(JSON.parse(savedOrders));
            }, []);

            const saveToLocal = (key, data) => localStorage.setItem(key, JSON.stringify(data));

            // UPLOAD DE IMAGEM (Base64)
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onloadend = () => setNewProduct({ ...newProduct, image: reader.result });
                if (file) reader.readAsDataURL(file);
            };

            const handleAddProduct = (e) => {
                e.preventDefault();
                const updated = [...products, { ...newProduct, id: Date.now(), price: parseFloat(newProduct.price) }];
                setProducts(updated);
                saveToLocal('luxury_products', updated);
                setNewProduct({ sku: '', name: '', price: '', image: '' });
            };

            // ROMANEIO IDENTICO AO MODELO (ABELLA JOIAS)
            const printRomaneio = (order) => {
                const printWindow = window.open('', '_blank', 'width=600,height=800');
                const content = `
                    <div style="font-family: Arial, sans-serif; max-width: 400px; margin: auto; padding: 20px; border: 1px solid #eee;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h2 style="margin: 0; letter-spacing: 2px;">${storeConfig.name.toUpperCase()}</h2>
                            <small>ALTA JOALHARIA & DESIGN</small>
                            <p style="margin: 10px 0; font-weight: bold; border-top: 1px solid #000; border-bottom: 1px solid #000; padding: 5px 0;">DOCUMENTO DE VENDA</p>
                            <p style="font-size: 12px;">Nº do Registro: ${order.id.toString().slice(-4)}<br>Data: ${order.date}</p>
                        </div>
                        <div style="font-size: 12px; margin-bottom: 20px;">
                            <strong>DESTINATARIO</strong><br>
                            ${order.customer.name.toUpperCase()}<br>
                            ${order.customer.phone}
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 20px;">
                            <thead>
                                <tr style="border-bottom: 1px solid #000;">
                                    <th align="left">DESCRIÇÃO DA PEÇA</th>
                                    <th align="center">QTD</th>
                                    <th align="right">SUBTOTAL</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.items.map(item => `
                                    <tr>
                                        <td style="padding: 10px 0;">${item.name}<br><small>SKU: ${item.sku}</small></td>
                                        <td align="center">${item.quantity || 1}</td>
                                        <td align="right">R$ ${item.price.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div style="border-top: 1px solid #000; padding-top: 10px; font-size: 12px;">
                            <div style="display: flex; justify-content: space-between;"><span>Subtotal:</span> <span>R$ ${order.subtotal.toFixed(2)}</span></div>
                            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px; margin-top: 5px;">
                                <span>TOTAL</span> <span>R$ ${order.total.toFixed(2)}</span>
                            </div>
                        </div>
                        <p style="font-size: 11px; margin-top: 20px;">
                            <strong>Forma de pagamento:</strong> ${order.paymentMethod === 'pix' ? 'PIX' : `Cartão (${order.installments}x)`}
                        </p>
                        <p style="font-size: 10px; text-align: center; margin-top: 30px; font-style: italic;">
                            Obrigado por escolher a excelência. Este documento comprova a autenticidade da sua transação.
                        </p>
                    </div>
                `;
                printWindow.document.write(`<html><body onload="window.print();window.close()">${content}</body></html>`);
                printWindow.document.close();
            };

            return (
                <div className="p-6 max-w-4xl mx-auto space-y-8">
                    {/* CONFIGURAÇÕES DE DESCONTO E PARCELAMENTO */}
                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2"><Icon name="settings" /> Configurações de Venda</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="text-xs font-bold text-gray-400 uppercase">Desconto PIX (Ex: 0.1 para 10%)</label>
                                <input type="number" step="0.01" className="w-full border-b py-2" value={storeConfig.pixDiscount} 
                                    onChange={e => { const c = {...storeConfig, pixDiscount: parseFloat(e.target.value)}; setStoreConfig(c); saveToLocal('luxury_config', c); }} />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-gray-400 uppercase">Parcelas Máximas (Cartão)</label>
                                <input type="number" className="w-full border-b py-2" value={storeConfig.maxInstallments} 
                                    onChange={e => { const c = {...storeConfig, maxInstallments: parseInt(e.target.value)}; setStoreConfig(c); saveToLocal('luxury_config', c); }} />
                            </div>
                        </div>
                    </div>

                    {/* CADASTRO COM UPLOAD DE IMAGEM */}
                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2"><Icon name="plus-circle" /> Cadastrar Produto</h2>
                        <form onSubmit={handleAddProduct} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input placeholder="Nome" className="border-b py-2" value={newProduct.name} onChange={e => setNewProduct({...newProduct, name: e.target.value})} />
                            <input placeholder="Preço" type="number" className="border-b py-2" value={newProduct.price} onChange={e => setNewProduct({...newProduct, price: e.target.value})} />
                            <input placeholder="SKU" className="border-b py-2" value={newProduct.sku} onChange={e => setNewProduct({...newProduct, sku: e.target.value})} />
                            <div className="flex flex-col gap-1">
                                <label className="text-[10px] uppercase font-bold text-gray-400">Imagem do Produto</label>
                                <input type="file" accept="image/*" onChange={handleImageUpload} className="text-xs" />
                            </div>
                            <button className="md:col-span-2 bg-black text-white py-3 rounded uppercase text-xs tracking-widest font-bold">Salvar Produto</button>
                        </form>
                    </div>

                    {/* HISTÓRICO DE PEDIDOS (Conforme sua imagem) */}
                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 className="font-bold mb-6 border-b pb-2">Histórico de Pedidos ({orders.length})</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left text-xs">
                                <thead>
                                    <tr className="text-gray-400 uppercase border-b">
                                        <th className="pb-3">Data/ID</th>
                                        <th className="pb-3">Cliente</th>
                                        <th className="pb-3">Valor</th>
                                        <th className="pb-3 text-right">Ações</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y">
                                    {orders.map(order => (
                                        <tr key={order.id} className="hover:bg-gray-50">
                                            <td className="py-4 font-mono">{order.date}<br/><span className="text-gray-400">ID: {order.id.toString().slice(-6)}</span></td>
                                            <td className="py-4"><strong>{order.customer.name}</strong><br/>{order.customer.phone}</td>
                                            <td className="py-4 font-bold">R$ {order.total.toFixed(2)}</td>
                                            <td className="py-4 text-right space-x-2">
                                                <button onClick={() => window.open(`https://wa.me/${order.customer.phone.replace(/\D/g, "")}`)} className="p-2 text-green-600 hover:bg-green-50 rounded" title="WhatsApp">
                                                    <Icon name="message-circle" />
                                                </button>
                                                <button onClick={() => printRomaneio(order)} className="p-2 text-blue-600 hover:bg-blue-50 rounded" title="Imprimir Romaneio">
                                                    <Icon name="printer" />
                                                </button>
                                                <button onClick={() => {
                                                    const updated = orders.filter(o => o.id !== order.id);
                                                    setOrders(updated); saveToLocal('luxury_orders', updated);
                                                }} className="p-2 text-red-500 hover:bg-red-50 rounded"><Icon name="trash-2" /></button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            {orders.length === 0 && <p className="text-center py-10 text-gray-400">Nenhum pedido registrado.</p>}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminApp />);
    </script>
</body>
</html>
