<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Royal Joias</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #FDFBF7; }
        .lux-card { background: white; border: 1px solid #E5DACE; border-radius: 4px; }
        input { border-bottom: 1px solid #E5DACE !important; outline: none; transition: all 0.3s; }
        input:focus { border-bottom-color: #A68966 !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{width: size, height: size}} className={`inline-block ${className}`}></i>;
        };

        function AdminApp() {
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [config, setConfig] = useState({ name: 'Royal Joias', whatsapp: '', pixDiscount: 10 });
            const [newProduct, setNewProduct] = useState({ sku: '', name: '', price: '', image: '' });

            useEffect(() => {
                const savedProducts = localStorage.getItem('luxury_products');
                const savedConfig = localStorage.getItem('luxury_config');
                const savedOrders = localStorage.getItem('luxury_orders');
                
                if (savedProducts) setProducts(JSON.parse(savedProducts));
                if (savedConfig) setConfig(JSON.parse(savedConfig));
                if (savedOrders) setOrders(JSON.parse(savedOrders));
            }, []);

            const formatMoney = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            // AÇÕES DE PRODUTO
            const handleAddProduct = (e) => {
                e.preventDefault();
                if (!newProduct.name || !newProduct.price) return;
                const updated = [...products, { ...newProduct, id: Date.now(), price: parseFloat(newProduct.price) }];
                setProducts(updated);
                localStorage.setItem('luxury_products', JSON.stringify(updated));
                setNewProduct({ sku: '', name: '', price: '', image: '' });
            };

            const deleteProduct = (id) => {
                const updated = products.filter(p => p.id !== id);
                setProducts(updated);
                localStorage.setItem('luxury_products', JSON.stringify(updated));
            };

            // AÇÕES DE CONFIGURAÇÃO
            const saveConfig = () => {
                localStorage.setItem('luxury_config', JSON.stringify(config));
                alert("Configurações atualizadas!");
            };

            // AÇÕES DE PEDIDOS
            const deleteOrder = (id) => {
                if (window.confirm("Deseja excluir este pedido permanentemente?")) {
                    const updated = orders.filter(o => o.id !== id);
                    setOrders(updated);
                    localStorage.setItem('luxury_orders', JSON.stringify(updated));
                }
            };

            const generatePDF = (order) => {
                const element = document.createElement('div');
                element.innerHTML = `
                    <div style="padding: 40px; font-family: serif; color: #2D2926;">
                        <h1 style="text-transform: uppercase; letter-spacing: 4px; border-bottom: 1px solid #A68966; padding-bottom: 10px;">${config.name}</h1>
                        <p><strong>PEDIDO:</strong> #${order.id || order.date}</p>
                        <p><strong>CLIENTE:</strong> ${order.cliente || order.customer?.name}</p>
                        <p><strong>DATA:</strong> ${order.data || order.date}</p>
                        <hr/>
                        <p><strong>ITENS:</strong> ${order.itens || order.items?.map(i => i.name).join(', ')}</p>
                        <p><strong>PAGAMENTO:</strong> ${order.pagamento || order.paymentMethod}</p>
                        <h2 style="color: #A68966;">TOTAL: ${formatMoney(order.total)}</h2>
                    </div>
                `;
                html2pdf().from(element).set({ margin: 10, filename: 'romaneio.pdf' }).save();
            };

            return (
                <div className="max-w-5xl mx-auto p-6 space-y-10 pb-20">
                    <header className="flex justify-between items-center border-b pb-6">
                        <h1 className="text-2xl font-serif uppercase tracking-widest">{config.name} - Admin</h1>
                        <button onClick={() => window.location.href='index.html'} className="text-xs font-bold uppercase border-b-2 border-black">Voltar para a Loja</button>
                    </header>

                    {/* CONFIGURAÇÃO */}
                    <section className="lux-card p-6">
                        <h2 className="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-2 text-[#A68966]">
                            <Icon name="settings" size={16}/> Configurações Gerais
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div><label className="text-[10px] uppercase text-gray-400 block mb-1">Nome da Loja</label>
                            <input className="w-full py-2" value={config.name} onChange={e => setConfig({...config, name: e.target.value})} /></div>
                            
                            <div><label className="text-[10px] uppercase text-gray-400 block mb-1">WhatsApp (Receber Pedidos)</label>
                            <input className="w-full py-2" value={config.whatsapp} onChange={e => setConfig({...config, whatsapp: e.target.value})} /></div>
                            
                            <div className="flex items-end"><button onClick={saveConfig} className="w-full bg-black text-white text-[10px] uppercase py-3 font-bold tracking-widest">Salvar Dados</button></div>
                        </div>
                    </section>

                    {/* CADASTRO PRODUTOS */}
                    <section className="lux-card p-6">
                        <h2 className="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-2 text-[#A68966]">
                            <Icon name="package" size={16}/> Gerenciar Catálogo
                        </h2>
                        <form onSubmit={handleAddProduct} className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                            <input placeholder="Nome da Joia" className="py-2" value={newProduct.name} onChange={e => setNewProduct({...newProduct, name: e.target.value})} />
                            <input placeholder="Preço" type="number" className="py-2" value={newProduct.price} onChange={e => setNewProduct({...newProduct, price: e.target.value})} />
                            <input placeholder="URL da Imagem" className="py-2" value={newProduct.image} onChange={e => setNewProduct({...newProduct, image: e.target.value})} />
                            <button className="bg-[#A68966] text-white text-[10px] uppercase font-bold py-2">Adicionar Peça</button>
                        </form>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                            {products.map(p => (
                                <div key={p.id} className="flex justify-between items-center p-3 border border-gray-50 bg-gray-50">
                                    <span className="text-xs font-bold uppercase">{p.name} - {formatMoney(p.price)}</span>
                                    <button onClick={() => deleteProduct(p.id)} className="text-red-400 hover:text-red-600"><Icon name="trash-2" size={14}/></button>
                                </div>
                            ))}
                        </div>
                    </section>

                    {/* HISTÓRICO DE PEDIDOS */}
                    <section className="lux-card p-6">
                        <h2 className="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-2 text-[#A68966]">
                            <Icon name="history" size={16}/> Histórico de Vendas
                        </h2>
                        <div className="space-y-4">
                            {orders.length === 0 ? <p className="text-center text-gray-400 py-10 italic">Nenhuma venda registrada.</p> : 
                             orders.map(order => (
                                <div key={order.id} className="border p-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 hover:border-[#A68966]">
                                    <div>
                                        <p className="text-xs font-bold uppercase">{order.cliente || order.customer?.name}</p>
                                        <p className="text-[10px] text-gray-400">{order.data || order.date} • <span className="text-[#A68966] font-bold">{formatMoney(order.total)}</span></p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={() => window.open(`https://wa.me/${(order.whatsapp || order.customer?.phone || "").replace(/\D/g, "")}`, '_blank')} 
                                                className="p-2 bg-green-500 text-white rounded hover:opacity-80" title="WhatsApp do Cliente">
                                            <Icon name="message-circle" size={16}/>
                                        </button>
                                        <button onClick={() => generatePDF(order)} 
                                                className="p-2 bg-blue-500 text-white rounded hover:opacity-80" title="Gerar Romaneio PDF">
                                            <Icon name="file-text" size={16}/>
                                        </button>
                                        <button onClick={() => deleteOrder(order.id)} 
                                                className="p-2 bg-red-100 text-red-500 rounded hover:bg-red-200" title="Excluir">
                                            <Icon name="trash-2" size={16}/>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </section>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminApp />);
    </script>
</body>
</html>
