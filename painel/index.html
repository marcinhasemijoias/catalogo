<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

<style>
body{background:#F8F6F2}
.font-serif{font-family:'Cinzel',serif}
.tab{display:none}.active{display:block}
</style>
</head>

<body>

<header class="bg-white border-b p-6 flex justify-between">
<h1 class="font-serif text-xl text-[#A68966]">Painel Admin</h1>
<nav class="flex gap-6 text-xs uppercase">
<button onclick="tab('config')">Config</button>
<button onclick="tab('products')">Produtos</button>
<button onclick="tab('orders')">Pedidos</button>
</nav>
</header>

<main class="max-w-5xl mx-auto p-8 space-y-12">

<section id="config" class="tab active space-y-6">
<h2 class="font-serif text-xl">Empresa</h2>
<input id="conf-whatsapp" placeholder="WhatsApp" class="border p-3 w-full">
<input id="conf-pix" placeholder="% PIX" type="number" class="border p-3 w-full">
<input id="conf-parcelas" placeholder="Parcelas" type="number" class="border p-3 w-full">

<input type="file" id="iconPix">
<input type="file" id="iconCard">

<button onclick="saveSettings()" class="bg-black text-white px-6 py-2">Salvar</button>
</section>

<section id="products" class="tab space-y-6">
<h2 class="font-serif text-xl">Produtos</h2>
<input id="p-name" placeholder="Nome" class="border p-3 w-full">
<input id="p-price" placeholder="PreÃ§o" type="number" class="border p-3 w-full">
<input id="p-stock" placeholder="Estoque" type="number" class="border p-3 w-full">
<input type="file" id="p-image">
<button onclick="saveProduct()" class="bg-black text-white px-6 py-2">Salvar</button>
</section>

<section id="orders" class="tab">
<div id="ordersList"></div>
</section>

</main>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyD5RdWTYOnaTov7VtM9ZGenUpFYSZVGoPs",
 databaseURL:"https://marcinha-semijoias-default-rtdb.firebaseio.com",
 projectId:"marcinha-semijoias"
});

const db=firebase.database();
const st=firebase.storage();

function tab(id){
 document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}

function saveSettings(){
 const data={
  whatsapp:conf-whatsapp.value,
  pix:parseInt(conf-pix.value),
  parcelas:parseInt(conf-parcelas.value)
 };

 const up=[];
 if(iconPix.files[0]){
  const r=st.ref('icons/pix.png');
  up.push(r.put(iconPix.files[0]).then(()=>r.getDownloadURL().then(u=>data.iconPix=u)));
 }
 if(iconCard.files[0]){
  const r=st.ref('icons/card.png');
  up.push(r.put(iconCard.files[0]).then(()=>r.getDownloadURL().then(u=>data.iconCard=u)));
 }

 Promise.all(up).then(()=>db.ref('settings').update(data));
}

function saveProduct(){
 const img=p-image.files[0];
 const r=st.ref('products/'+Date.now());
 r.put(img).then(()=>r.getDownloadURL().then(u=>{
  db.ref('products').push({
   name:p-name.value,
   price:+p-price.value,
   stock:+p-stock.value,
   image:u
  });
 }));
}

db.ref('orders').on('value',s=>{
 ordersList.innerHTML='';
 s.forEach(o=>{
  ordersList.innerHTML+=`
  <div class="bg-white border p-3 mb-2">
   <strong>R$ ${o.val().total}</strong><br>
   <span class="text-xs">${o.val().date}</span>
  </div>`;
 });
});
</script>

</body>
</html>
