<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Completo | Marcinha Semijoias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #FDFBF7; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="max-w-5xl mx-auto mb-10 border-b pb-6">
        <h1 class="font-serif text-2xl uppercase tracking-widest text-[#A68966]">Gestão Profissional</h1>
        <p id="status" class="text-[10px] text-green-500 font-bold uppercase mt-1">● Sistema Sincronizado</p>
        
        <nav class="flex gap-4 mt-6">
            <button onclick="openTab('produtos')" class="text-[10px] uppercase tracking-widest font-bold border-b-2 border-[#A68966] pb-1">Produtos</button>
            <button onclick="openTab('config')" class="text-[10px] uppercase tracking-widest font-bold border-b-2 border-transparent pb-1">Configuração</button>
            <button onclick="openTab('vendas')" class="text-[10px] uppercase tracking-widest font-bold border-b-2 border-transparent pb-1">Vendas/Pedidos</button>
        </nav>
    </header>

    <main class="max-w-5xl mx-auto">
        
        <div id="produtos" class="tab-content active space-y-8">
            <section class="bg-white p-6 border border-[#E5E1DB]">
                <h2 class="font-serif text-lg mb-4">Novo Produto</h2>
                <form id="productForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="pName" placeholder="Nome da Peça" class="border p-3 text-sm" required>
                    <input type="number" id="pPrice" placeholder="Preço" step="0.01" class="border p-3 text-sm" required>
                    <input type="text" id="pImage" placeholder="Link da Imagem" class="border p-3 text-sm" required>
                    <input type="number" id="pStock" placeholder="Estoque" class="border p-3 text-sm" required>
                    <select id="pCategory" class="border p-3 text-sm bg-white md:col-span-2" required>
                        <option value="" disabled selected>Escolha a Categoria</option>
                        <option value="Brincos">Brincos</option>
                        <option value="Colares">Colares</option>
                        <option value="Pulseiras">Pulseiras</option>
                        <option value="Aneis">Aneis</option>
                    </select>
                    <button type="submit" class="md:col-span-2 bg-black text-white py-4 text-[10px] uppercase tracking-widest">Salvar na Nuvem</button>
                </form>
            </section>
            <div id="adminProductList" class="space-y-2"></div>
        </div>

        <div id="config" class="tab-content space-y-8">
            <section class="bg-white p-6 border border-[#E5E1DB]">
                <h2 class="font-serif text-lg mb-4">Dados da Loja</h2>
                <form id="configForm" class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">WhatsApp (DDD + Número)</label>
                        <input type="text" id="storePhone" placeholder="Ex: 11999999999" class="w-full border p-3 text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">% Desconto no PIX</label>
                        <input type="number" id="pixDiscount" placeholder="Ex: 5" class="w-full border p-3 text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-gray-400">Parcelas Máximas (Cartão)</label>
                        <input type="number" id="maxInstallments" placeholder="Ex: 3" class="w-full border p-3 text-sm">
                    </div>
                    <button type="submit" class="bg-[#A68966] text-white py-4 text-[10px] uppercase tracking-widest">Atualizar Configurações</button>
                </form>
            </section>
        </div>

        <div id="vendas" class="tab-content space-y-8">
            <section class="bg-white p-6 border border-[#E5E1DB]">
                <h2 class="font-serif text-lg mb-4">Últimos Pedidos</h2>
                <div id="ordersList" class="space-y-4">
                    <p class="text-xs text-gray-400">Nenhum pedido registrado ainda.</p>
                </div>
            </section>
        </div>

    </main>

    <script>
        // Suas chaves do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD5RdWTYOnaTov7VtM9ZGenUpFYSZVGoPs",
            authDomain: "marcinha-semijoias.firebaseapp.com",
            databaseURL: "https://marcinha-semijoias-default-rtdb.firebaseio.com",
            projectId: "marcinha-semijoias",
            storageBucket: "marcinha-semijoias.firebasestorage.app",
            messagingSenderId: "830107812924",
            appId: "1:830107812924:web:1ee54d9b875514e48eef39"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Alternar entre abas
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelectorAll('nav button').forEach(btn => btn.style.borderColor = 'transparent');
            event.currentTarget.style.borderColor = '#A68966';
        }

        // --- LÓGICA DE PRODUTOS ---
        db.ref('products').on('value', (snapshot) => {
            const data = snapshot.val();
            const products = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
            const list = document.getElementById("adminProductList");
            list.innerHTML = products.map(p => `
                <div class="flex items-center justify-between bg-white p-4 border border-[#E5E1DB]">
                    <div class="flex items-center gap-4">
                        <img src="${p.image}" class="w-12 h-12 object-cover">
                        <div>
                            <p class="text-xs font-bold uppercase">${p.name} <span class="text-[9px] text-gray-400">(${p.category})</span></p>
                            <p class="text-[10px] text-gray-400">R$ ${Number(p.price).toFixed(2)} | Estoque: ${p.stock}</p>
                        </div>
                    </div>
                    <button onclick="deleteProduct('${p.id}')" class="text-red-300 hover:text-red-500 text-xs">Excluir</button>
                </div>
            `).join('');
        });

        document.getElementById("productForm").addEventListener("submit", (e) => {
            e.preventDefault();
            const newProduct = {
                name: document.getElementById("pName").value,
                price: parseFloat(document.getElementById("pPrice").value),
                image: document.getElementById("pImage").value,
                stock: parseInt(document.getElementById("pStock").value),
                category: document.getElementById("pCategory").value
            };
            db.ref('products').push(newProduct);
            e.target.reset();
        });

        function deleteProduct(id) {
            if(confirm("Excluir definitivamente?")) db.ref('products/' + id).remove();
        }

        // --- LÓGICA DE CONFIGURAÇÃO ---
        db.ref('settings').on('value', (snapshot) => {
            const settings = snapshot.val();
            if (settings) {
                document.getElementById('storePhone').value = settings.phone || "";
                document.getElementById('pixDiscount').value = settings.pixDiscount || "";
                document.getElementById('maxInstallments').value = settings.installments || "";
            }
        });

        document.getElementById("configForm").addEventListener("submit", (e) => {
            e.preventDefault();
            const settings = {
                phone: document.getElementById('storePhone').value,
                pixDiscount: document.getElementById('pixDiscount').value,
                installments: document.getElementById('maxInstallments').value
            };
            db.ref('settings').set(settings).then(() => alert("Configurações atualizadas na nuvem!"));
        });

        // --- LÓGICA DE PEDIDOS (VENDAS) ---
        db.ref('orders').on('value', (snapshot) => {
            const data = snapshot.val();
            const orders = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
            const list = document.getElementById("ordersList");
            if (orders.length === 0) {
                list.innerHTML = `<p class="text-xs text-gray-400">Nenhum pedido registrado.</p>`;
                return;
            }
            list.innerHTML = orders.reverse().map(o => `
                <div class="p-4 border bg-[#FDFBF7] text-xs">
                    <div class="flex justify-between font-bold mb-2">
                        <span>${o.customerName}</span>
                        <span>${o.date}</span>
                    </div>
                    <p class="text-gray-500">Total: R$ ${o.total} via ${o.payment}</p>
                </div>
            `).join('');
        });
    </script>
</body>
</html>
