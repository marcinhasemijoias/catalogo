<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo | Marcinha Semijoias</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f6f6f6;
  margin:0;
  padding:20px;
}
h1{text-align:center}
.order{
  background:#fff;
  border:1px solid #ddd;
  padding:15px;
  margin-bottom:15px;
}
button{
  background:#000;
  color:#fff;
  border:0;
  padding:8px 12px;
  cursor:pointer;
  margin-top:10px;
}
button:hover{opacity:.85}
small{color:#666}
</style>
</head>
<body>

<h1>Painel Administrativo</h1>

<div id="orders">Carregando pedidos...</div>

<!-- MODELO DO PDF (OCULTO) -->
<div id="pdf" style="display:none;padding:30px;font-family:Arial">
  <h2 style="text-align:center">Marcinha Semijoias</h2>
  <p id="pdfCliente"></p>
  <p id="pdfData"></p>
  <hr>
  <div id="pdfItens"></div>
  <hr>
  <p><strong>Total:</strong> R$ <span id="pdfTotal"></span></p>
  <p style="margin-top:40px">
    Assinatura: _______________________________
  </p>
</div>

<script>
/* ðŸ”¥ CONFIG FIREBASE */
const firebaseConfig={
  apiKey:"SUA_API_KEY",
  authDomain:"SEU_AUTH",
  databaseURL:"SUA_DATABASE",
  projectId:"SEU_PROJECT",
  storageBucket:"SEU_BUCKET"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

/* ðŸ“¦ CARREGAR PEDIDOS */
db.ref('orders').on('value', snap=>{
  const box=document.getElementById('orders');
  box.innerHTML='';

  if(!snap.exists()){
    box.innerHTML='<p>Nenhum pedido registrado.</p>';
    return;
  }

  snap.forEach(o=>{
    const v=o.val();
    const data=new Date(v.createdAt || Date.now()).toLocaleDateString();

    box.innerHTML+=`
      <div class="order">
        <strong>Cliente:</strong> ${v.customer}<br>
        <small>Data: ${data}</small><br><br>

        <strong>Total:</strong> R$ ${v.total}<br>
        <strong>Status:</strong> ${v.status || 'novo'}<br>

        <button onclick="gerarPDF('${o.key}')">
          Gerar PDF / Romaneio
        </button>
      </div>
    `;
  });
});

/* ðŸ§¾ GERAR PDF A4 */
function gerarPDF(id){
  db.ref('orders/'+id).once('value', snap=>{
    const o=snap.val();

    pdfCliente.innerText="Cliente: "+o.customer;
    pdfData.innerText="Data: "+new Date(o.createdAt).toLocaleDateString();
    pdfTotal.innerText=o.total;

    pdfItens.innerHTML='';
    o.items.forEach(i=>{
      pdfItens.innerHTML+=`
        <p>${i.name} â€” R$ ${i.price}</p>
      `;
    });

    html2pdf().set({
      margin:10,
      filename:`pedido-${id}.pdf`,
      html2canvas:{scale:2},
      jsPDF:{unit:'mm',format:'a4'}
    }).from(document.getElementById('pdf')).save();
  });
}
</script>

</body>
</html>
