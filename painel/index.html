<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo | Marcinha Semijoias</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f6f6f6;
  margin:0;
  padding:20px;
}
h1{text-align:center;margin-bottom:30px}

.order{
  background:#fff;
  border:1px solid #ddd;
  padding:15px;
  margin-bottom:15px;
}

.badge{
  display:inline-block;
  padding:4px 8px;
  font-size:11px;
  font-weight:bold;
  text-transform:uppercase;
  margin-bottom:8px;
}

.novo{background:#eee;color:#333}
.pago{background:#d1fae5;color:#065f46}
.entregue{background:#e0e7ff;color:#3730a3}
.cancelado{background:#fee2e2;color:#991b1b}

select,button{
  padding:6px;
  margin-top:6px;
}
button{
  background:#000;
  color:#fff;
  border:0;
  cursor:pointer;
}
button:hover{opacity:.85}
small{color:#666}
</style>
</head>
<body>

<h1>Painel Administrativo</h1>

<div id="orders">Carregando pedidos...</div>

<!-- PDF (OCULTO) -->
<div id="pdf" style="display:none;padding:30px;font-family:Arial">
  <h2 style="text-align:center">Marcinha Semijoias</h2>
  <p id="pdfCliente"></p>
  <p id="pdfData"></p>
  <p id="pdfStatus"></p>
  <hr>
  <div id="pdfItens"></div>
  <hr>
  <p><strong>Total:</strong> R$ <span id="pdfTotal"></span></p>
  <p style="margin-top:40px">
    Assinatura: _______________________________
  </p>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig={
  apiKey:"SUA_API_KEY",
  authDomain:"SEU_AUTH",
  databaseURL:"SUA_DATABASE",
  projectId:"SEU_PROJECT",
  storageBucket:"SEU_BUCKET"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

/* ðŸ“¦ LISTAR PEDIDOS */
db.ref('orders').on('value', snap=>{
  const box=document.getElementById('orders');
  box.innerHTML='';

  if(!snap.exists()){
    box.innerHTML='<p>Nenhum pedido registrado.</p>';
    return;
  }

  snap.forEach(o=>{
    const v=o.val();
    const status=v.status || 'novo';
    const data=new Date(v.createdAt || Date.now()).toLocaleDateString();

    box.innerHTML+=`
      <div class="order">
        <div class="badge ${status}">${status}</div><br>

        <strong>Cliente:</strong> ${v.customer}<br>
        <small>Data: ${data}</small><br><br>

        <strong>Total:</strong> R$ ${v.total}<br><br>

        <label>Status:</label><br>
        <select onchange="updateStatus('${o.key}',this.value)">
          <option value="novo" ${status==='novo'?'selected':''}>Novo</option>
          <option value="pago" ${status==='pago'?'selected':''}>Pago</option>
          <option value="entregue" ${status==='entregue'?'selected':''}>Entregue</option>
          <option value="cancelado" ${status==='cancelado'?'selected':''}>Cancelado</option>
        </select><br>

        <button onclick="gerarPDF('${o.key}')">
          Gerar PDF / Romaneio
        </button>
      </div>
    `;
  });
});

/* ðŸ”„ ATUALIZAR STATUS */
function updateStatus(id,status){
  db.ref('orders/'+id).update({status});
}

/* ðŸ§¾ GERAR PDF */
function gerarPDF(id){
  db.ref('orders/'+id).once('value', snap=>{
    const o=snap.val();

    pdfCliente.innerText="Cliente: "+o.customer;
    pdfData.innerText="Data: "+new Date(o.createdAt).toLocaleDateString();
    pdfStatus.innerText="Status: "+(o.status||'novo');
    pdfTotal.innerText=o.total;

    pdfItens.innerHTML='';
    o.items.forEach(i=>{
      pdfItens.innerHTML+=`<p>${i.name} â€” R$ ${i.price}</p>`;
    });

    html2pdf().set({
      margin:10,
      filename:`pedido-${id}.pdf`,
      html2canvas:{scale:2},
      jsPDF:{unit:'mm',format:'a4'}
    }).from(document.getElementById('pdf')).save();
  });
}
</script>

</body>
</html>
