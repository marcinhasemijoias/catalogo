<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{font-family:Arial;background:#111;color:#fff}
input,button{padding:8px;margin:5px;width:100%}
section{max-width:500px;margin:30px auto}
.hidden{display:none}
.order{border:1px solid #444;padding:10px;margin:10px 0}
.status-novo{color:orange}
.status-pago{color:yellow}
.status-enviado{color:lightgreen}
</style>
</head>
<body>

<section id="login">
<h2>Login Admin</h2>
<input id="email" placeholder="Email">
<input id="pass" type="password">
<button onclick="login()">Entrar</button>
</section>

<section id="painel" class="hidden">
<h2>Painel Administrativo</h2>

<h3>Novo Produto</h3>
<input id="name" placeholder="Nome">
<input id="price" placeholder="Preço">
<input id="stock" placeholder="Estoque">
<input type="file" id="image">
<button onclick="addProduct()">Salvar Produto</button>

<h3>Pedidos</h3>
<div id="orders"></div>

<h3>Relatório Mensal</h3>
<pre id="report"></pre>

<button onclick="logout()">Sair</button>
</section>

<script>
const firebaseConfig={
 apiKey:"SUA_API_KEY",
 authDomain:"SEU_AUTH",
 databaseURL:"SUA_DATABASE",
 projectId:"SEU_PROJECT",
 storageBucket:"SEU_BUCKET"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();

auth.onAuthStateChanged(u=>{
 login.classList.toggle('hidden',!!u);
 painel.classList.toggle('hidden',!u);
 if(u){loadOrders();loadReport();}
});

function login(){
 auth.signInWithEmailAndPassword(email.value,pass.value)
 .catch(e=>alert(e.message));
}
function logout(){auth.signOut();}

function addProduct(){
 const file=image.files[0];
 const ref=storage.ref('products/'+Date.now());
 ref.put(file).then(r=>r.ref.getDownloadURL()).then(url=>{
  db.ref('products').push({
   name:name.value,
   price:price.value,
   stock:Number(stock.value),
   image:url
  });
  alert("Produto cadastrado");
 });
}

function updateStatus(id,status){
 db.ref('orders/'+id).update({status});
}

function loadOrders(){
 db.ref('orders').on('value', s=>{
  orders.innerHTML='';
  s.forEach(o=>{
   const v=o.val();
   orders.innerHTML+=`
   <div class="order">
    <strong>${v.customer}</strong><br>
    Total: R$ ${v.total}<br>
    <span class="status-${v.status}">Status: ${v.status}</span>
    <button onclick="updateStatus('${o.key}','pago')">Marcar Pago</button>
    <button onclick="updateStatus('${o.key}','enviado')">Marcar Enviado</button>
   </div>`;
  });
 });
}

function loadReport(){
 db.ref('orders').on('value', s=>{
  let total=0,count=0;
  const m=new Date().getMonth();
  s.forEach(o=>{
   const d=new Date(o.val().createdAt);
   if(d.getMonth()===m){
    total+=Number(o.val().total);
    count++;
   }
  });
  report.textContent=
`Pedidos: ${count}
Total: R$ ${total.toFixed(2)}
Ticket Médio: R$ ${(total/count||0).toFixed(2)}`;
 });
}
</script>
</body>
</html>
