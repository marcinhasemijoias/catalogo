<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Loja</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-neutral-50">

<header class="p-4 text-center border-b relative">
  <h1 class="text-2xl font-serif">
    <script>document.write(localStorage.getItem("storeName") || "Minha Loja")</script>
  </h1>

  <a href="../cart.html" class="absolute top-4 right-4 text-sm">
    ðŸ›’ Carrinho (<span id="cartCount">0</span>)
  </a>
</header>

<main id="products"
  class="max-w-4xl mx-auto p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
</main>

<script>
const products = JSON.parse(localStorage.getItem("products")) || [];
const cart = JSON.parse(localStorage.getItem("cart")) || [];

const pixDiscount = Number(localStorage.getItem("pixDiscount") || 0);
const maxInstallments = Number(localStorage.getItem("maxInstallments") || 1);

document.getElementById("cartCount").innerText =
  cart.reduce((a, b) => a + b.qty, 0);

const container = document.getElementById("products");

products.forEach(p => {
  const pixPrice = (p.price * (1 - pixDiscount / 100)).toFixed(2);
  const installment = (p.price / maxInstallments).toFixed(2);

  container.innerHTML += `
    <div class="border bg-white p-4 text-center space-y-2">
      <img src="${p.image}" class="h-40 mx-auto object-contain">
      <h3>${p.name}</h3>

      <p class="text-sm">R$ ${p.price.toFixed(2)}</p>
      <p class="text-green-600 text-sm">
        PIX: R$ ${pixPrice}
      </p>
      <p class="text-xs text-gray-500">
        ou ${maxInstallments}x de R$ ${installment}
      </p>

      <button onclick="add('${p.id}')"
        class="bg-black text-white px-4 py-2 text-sm">
        Adicionar
      </button>
    </div>
  `;
});

function add(id) {
  const p = products.find(x => x.id === id);
  const item = cart.find(x => x.id === id);

  if (item) item.qty++;
  else cart.push({ ...p, qty: 1 });

  localStorage.setItem("cart", JSON.stringify(cart));
  location.reload();
}
</script>

</body>
</html>
