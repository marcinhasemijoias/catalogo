<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Finalizar Pedido</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#FDFBF7] text-[#2D2926]">

<header class="text-center py-6">
  <h1 class="text-xl font-serif">Finalizar Pedido</h1>
</header>

<main class="max-w-md mx-auto px-6 space-y-6">

  <input id="name" class="w-full border p-3 text-sm" placeholder="Nome">
  <input id="phone" class="w-full border p-3 text-sm" placeholder="WhatsApp">

  <div id="summary" class="border p-4 text-xs space-y-2"></div>

  <button onclick="sendWhats()"
    class="w-full bg-black text-white py-4 text-xs uppercase">
    Finalizar no WhatsApp
  </button>

</main>

<script>
const cart = JSON.parse(localStorage.getItem('luxury_cart')) || [];
const store = JSON.parse(localStorage.getItem('luxury_config')) || {};
const payment = localStorage.getItem('luxury_payment') || 'pix';

const format = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

let subtotal = cart.reduce((s,p)=>s+p.price*p.qty,0);
let discount = payment==='pix'
  ? subtotal * (store.pixDiscount || 0)
  : 0;

const total = subtotal - discount;

const box = document.getElementById('summary');
box.innerHTML = `
  <p><strong>${store.name}</strong></p>
  ${cart.map(p=>`<p>${p.qty}x ${p.name}</p>`).join('')}
  <hr>
  <p>Pagamento: ${payment==='pix'?'PIX':'Cartão'}</p>
  <p>Total: <strong>${format(total)}</strong></p>
`;

function sendWhats(){
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;

  let msg = `*Pedido - ${store.name}*\n`;
  msg += `Cliente: ${name}\n\n`;

  cart.forEach(p=>{
    msg += `${p.qty}x ${p.name}\n`;
  });

  msg += `\nPagamento: ${payment==='pix'?'PIX':'Cartão'}`;
  msg += `\nTotal: ${format(total)}`;

  window.open(
    `https://wa.me/${store.whatsapp}?text=${encodeURIComponent(msg)}`,
    '_blank'
  );
}
</script>

</body>
</html>
